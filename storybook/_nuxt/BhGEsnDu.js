import{_ as he}from"./D9o9W2R6.js";import{_ as ve}from"./BWSCz0Ct.js";import{d as be,$ as m,c as w,r as h,w as L,k as ge,Q as $,l as Se,u as t,O as v,P as b,e as c,U as E,V as y,W as we,S as ye,R as _e,K as xe,L as q,N as ke,j as G,n as Ce}from"./53SD24Bo.js";import{o as Re}from"./7RO02bE1.js";import{C as Ie,R as Te}from"./DiNJJo8Y.js";import{s as Be}from"./Bl5m8s2n.js";import{f as $e}from"./whaKyvbR.js";import{e as z,g as Ee,a as Ve}from"./C8lB5fex.js";import{f as Fe}from"./ZpMnOia7.js";import{u as Ne,a as De}from"./CI6-PtcM.js";import{u as Me}from"./BL_FgS7q.js";import{u as Oe}from"./DhFt9uP4.js";import{u as He}from"./8cLBg1iv.js";import{u as Ke}from"./D1nsP1gg.js";import{_ as Ae}from"./CXejdseU.js";import{_ as Pe}from"./zHYd-DqB.js";import{_ as Le}from"./W0-MHBmS.js";import{_ as qe}from"./DqnqsLzS.js";import{V as j}from"./B-glawQd.js";import{u as Ge}from"./D1l3oJXo.js";import{u as ze,a as je}from"./fL1fV1YB.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},g=new u.Error().stack;g&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[g]="106bc5dd-d4e2-467b-aff3-6f7bca4891bb",u._sentryDebugIdIdentifier="sentry-dbid-106bc5dd-d4e2-467b-aff3-6f7bca4891bb")}catch{}})();const Qe=["placeholder","value","aria-label","aria-expanded","aria-activedescendant"],Ue=be({__name:"VHeaderMobile",emits:["open","close"],setup(u,{emit:g}){const d=m("searchInputRef"),_=m("headerRef"),x=m("recentSearchesRef"),V=m("contentSettingsButtonRef"),Q=w(()=>{var e;return((e=V.value)==null?void 0:e.$el)??void 0}),U=m("clearButtonRef"),W=Ne(),J=De(),f=h(!1),r=h(!1),k=h(!1),X=w(()=>J.appliedFilterCount),F=w(()=>W.isFetching),C=h({start:0,end:0}),{$sendCustomEvent:Y}=Ge(),{updateSearchState:Z,searchTerm:p,searchStatus:N}=Oe(Y),n=h(p.value),D=()=>{const e=d.value;e&&(z(e),e.selectionStart=C.value.start,e.selectionEnd=C.value.end)},ee=()=>{n.value&&n.value!==p.value&&(p.value=n.value),R(),M()},M=()=>{window.scrollTo({top:0,left:0,behavior:"auto"}),Z()},O=()=>{r.value=!0,f.value=!0,o.value||se()},S=()=>{r.value=!1,f.value=!1},H=()=>{const e=d.value;if(!e)return;const a=e.value.length>0?e.value.length-1:0;C.value={start:e.selectionStart??a,end:e.selectionEnd??a}},te=()=>{const e=d.value;e&&(n.value=e.value,H(),r.value&&!f.value&&O())},ae=()=>{n.value="",D()},{handleKeydown:K,handleSelect:ne,handleClear:oe,recent:{isVisible:o,show:se,hide:R,entries:re,selectedIdx:I}}=Ke({focusInput:D,term:n,isMobile:!0,isInputFocused:r});L(o,e=>{e||(S(),n.value!==p.value&&(p.value=n.value,M()))});const le=()=>r.value=!0,ie=()=>{!o.value&&r.value&&S()};Re(_,e=>{var s,l;((l=(s=x.value)==null?void 0:s.$el)==null?void 0:l.contains(e.target))||(r.value=!1)});const ce=()=>{f.value||(H(),O())},T=e=>{R(),Ce().then(()=>{const a=e==="forward"?document.getElementById(Be):Ee(document.body)[1];z(a??Ve(document.body))})},ue=g,{close:A,onTriggerClick:de,triggerA11yProps:fe}=Me({id:Ie,visibleRef:k,nodeRef:_,lockBodyScroll:!0,emit:ue}),B=ze(),pe=w(()=>$e(B==null?void 0:B.query.q));L(pe,e=>{n.value=e??""});const{doneHydrating:me}=He();je().beforeEach((e,a,s)=>{e.path!==a.path&&(A(),S()),s()});const P=(e,a)=>{var s;if(o.value){e.preventDefault();const l=(s=x.value)==null?void 0:s.$el;l&&Fe(l,1)}else a==="content-settings"&&T("forward")};return(e,a)=>{const s=he,l=ve;return G(),ge("header",{ref_key:"headerRef",ref:_,class:"main-header z-30 flex w-full items-center px-6 py-4"},[$("form",{action:"/search",class:_e(["search-bar group flex h-12 w-full flex-row items-center overflow-hidden rounded-sm",f.value||r.value?"bg-default ring ring-focus":"bg-surface"]),onSubmit:y(ee,["prevent"])},[Se(e.$slots,"start",{},()=>[v(c(Ae,{"is-fetching":F.value,class:"focus-visible:me-1.5px focus-visible:ms-1.5px focus-visible:!h-[45px] focus-visible:max-w-[45px]"},null,8,["is-fetching"]),[[b,!t(o)]]),v(c(j,{icon:"chevron-back",label:e.$t("header.backButton"),"rtl-flip":!0,variant:"filled-gray",onClick:t(R),onKeydown:a[0]||(a[0]=E(y(i=>T("backward"),["shift"]),["tab"]))},null,8,["label","onClick"]),[[b,t(o)]])]),$("input",{id:"search-bar",ref_key:"searchInputRef",ref:d,name:"q",placeholder:e.$t("hero.search.placeholder"),type:"search",class:"search-field ms-1 h-full w-full flex-grow appearance-none rounded-none border-tx bg-tx text-2xl text-secondary placeholder-default hover:text-default focus-visible:outline-none",value:n.value,"aria-label":e.$t("search.searchBarLabel",{openverse:"Openverse"}),autocomplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":t(o)?"true":"false","aria-controls":"recent-searches-list","aria-haspopup":"listbox","aria-activedescendant":t(I)===void 0?void 0:`option-${t(I)}`,onInput:te,onKeydown:a[1]||(a[1]=(...i)=>t(K)&&t(K)(...i)),onFocus:le,onFocusout:ie,onClick:ce},null,40,Qe),v(c(j,{ref_key:"clearButtonRef",ref:U,icon:"close-small",label:e.$t("browsePage.searchForm.clear"),onClick:ae,onKeydown:a[2]||(a[2]=E(y(i=>P(i,"clear-input"),["exact"]),["tab"]))},null,8,["label"]),[[b,t(o)&&n.value]]),v($("span",{class:"info mx-4 hidden whitespace-nowrap text-xs group-hover:text-default group-focus:text-default md:flex"},we(t(N)),513),[[b,!f.value&&t(N)]]),v(c(Le,ye({ref_key:"contentSettingsButtonRef",ref:V,"is-pressed":k.value,"applied-filter-count":X.value},t(fe),{disabled:!t(me),onClick:t(de),onKeydown:a[3]||(a[3]=E(y(i=>P(i,"content-settings"),["exact"]),["tab"]))}),null,16,["is-pressed","applied-filter-count","disabled","onClick"]),[[b,!t(o)]]),c(Pe,{variant:"two-thirds",visible:k.value,"is-fetching":F.value,close:t(A),"trigger-element":Q.value,labelledby:"content-settings-button"},null,8,["visible","is-fetching","close","trigger-element"])],34),t(o)?(G(),xe(l,{key:0,id:t(Te),visible:!0,hide:S,"trigger-element":t(d),"trap-focus":!1,"auto-focus-on-show":!1,"auto-focus-on-hide":!1,"content-classes":"px-3","aria-label":e.$t("recentSearches.heading"),variant:"mobile-input"},{default:q(()=>[c(s,null,{default:q(()=>[c(qe,{ref_key:"recentSearchesRef",ref:x,class:"w-[100dvw] px-3","selected-idx":t(I),entries:t(re),bordered:!1,onSelect:t(ne),onClear:t(oe),onLastTab:a[4]||(a[4]=i=>T("forward"))},null,8,["selected-idx","entries","onSelect","onClear"])]),_:1})]),_:1},8,["id","trigger-element","aria-label"])):ke("",!0)],512)}}});Ue.__docgenInfo={exportName:"default",displayName:"VHeaderMobile",description:"",tags:{},events:[{name:"open"},{name:"close"}],slots:[{name:"start"}],sourceFiles:["/home/runner/work/openverse/openverse/frontend/src/components/VHeader/VHeaderMobile/VHeaderMobile.vue"]};export{Ue as _};
