import{d as T,p as C,ab as L,h as k,r as x,a as A,w as j,ad as q,n as D,F as M,ae as $,c as _,a0 as Q,j as w,k as F,K as V,e as P,u as H}from"./53SD24Bo.js";import{P as I,L as W,a as z,R as G,u as J,n as U}from"./fL1fV1YB.js";import{g as K,_ as X,w as Y,t as Z,e as ee,d as te}from"./CFtBlWI-.js";import{u as B,c as N,d as ae}from"./D1l3oJXo.js";import{s as ne}from"./D4B1y8Wp.js";import{s as re}from"./Bl5m8s2n.js";import{u as oe,a as se,i as O,b as ie}from"./CI6-PtcM.js";import{i as ue,h as ce}from"./CgGS_2A8.js";import"./Bk8VSEei.js";import{u as le}from"./B8akBo1x.js";import{_ as de}from"./B17tFtD7.js";import{u as fe}from"./DiDXdeoC.js";import{u as me}from"./BKjg0pyS.js";import{w as pe}from"./7RO02bE1.js";import"./C7m8LBdt.js";import"./DlQTGb70.js";import"./Bac5q-Us.js";import"./okj3qyDJ.js";import"./BSHtV9yS.js";import"./DcbA7sTY.js";import"./whaKyvbR.js";import"./DZSCtjcm.js";import"./DUD5NJ41.js";import"./D8ErYsGz.js";import"./B06vE1PI.js";import"./Dm9fL15Y.js";import"./S07_m3Bd.js";import"./BQrorSEU.js";import"./BLjgfQlY.js";import"./DBpyOWk7.js";import"./DLXib-Qm.js";import"./CA_M5S-4.js";import"./Cx3b_-up.js";import"./7RAMVlBS.js";import"../sb-preview/runtime.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new t.Error().stack;r&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[r]="9c2524a4-388c-4f54-8409-19dc5c823477",t._sentryDebugIdIdentifier="sentry-dbid-9c2524a4-388c-4f54-8409-19dc5c823477")}catch{}})();const he=T({props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(t){const r=t.renderKey,a=t.route,c={};for(const n in t.route)Object.defineProperty(c,n,{get:()=>r===t.renderKey?t.route[n]:a[n],enumerable:!0});return C(I,L(c)),()=>k(t.vnode,{ref:t.vnodeRef})}}),ge=T({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(t,{attrs:r,slots:a,expose:c}){const n=B(),o=x(),i=A(I,null);let f;c({pageRef:o});const s=A(W,null);let l;const g=n.deferHydration();if(n.isHydrating){const e=n.hooks.hookOnce("app:error",g);z().beforeEach(e)}return t.pageKey&&j(()=>t.pageKey,(e,y)=>{e!==y&&n.callHook("page:loading:start")}),()=>k(G,{name:t.name,route:t.route,...r},{default:e=>{const y=ve(i,e.route,e.Component),v=i&&i.matched.length===e.route.matched.length;if(!e.Component){if(l&&!v)return l;g();return}if(l&&s&&!s.isCurrent(e.route))return l;if(y&&i&&(!s||s!=null&&s.isCurrent(i)))return v?l:null;const d=K(e,t.pageKey);!n.isHydrating&&!_e(i,e.route,e.Component)&&f===d&&n.callHook("page:loading:end"),f=d;const p=!!(t.transition??e.route.meta.pageTransition??N),S=p&&ye([t.transition,e.route.meta.pageTransition,N,{onAfterLeave:()=>{n.callHook("page:transition:finish",e.Component)}}].filter(Boolean)),R=t.keepalive??e.route.meta.keepalive??ae;return l=X($,p&&S,Y(R,k(q,{suspensible:!0,onPending:()=>n.callHook("page:start",e.Component),onResolve:()=>{D(()=>n.callHook("page:finish",e.Component).then(()=>n.callHook("page:loading:end")).finally(g))}},{default:()=>{const b=k(he,{key:d||void 0,vnode:a.default?k(M,void 0,a.default(e)):e.Component,route:e.route,renderKey:d||void 0,trackRootNodes:p,vnodeRef:o});return R&&(b.type.name=e.Component.type.name||e.Component.type.__name||"RouteProvider"),b}}))).default(),l}})}});function ye(t){const r=t.map(a=>({...a,onAfterLeave:a.onAfterLeave?Z(a.onAfterLeave):void 0}));return ee(...r)}function ve(t,r,a){if(!t)return!1;const c=r.matched.findIndex(n=>{var o;return((o=n.components)==null?void 0:o.default)===(a==null?void 0:a.type)});return!c||c===-1?!1:r.matched.slice(0,c).some((n,o)=>{var i,f,s;return((i=n.components)==null?void 0:i.default)!==((s=(f=t.matched[o])==null?void 0:f.components)==null?void 0:s.default)})||a&&K({route:r,Component:a})!==K({route:t,Component:a})}function _e(t,r,a){return t?r.matched.findIndex(n=>{var o;return((o=n.components)==null?void 0:o.default)===(a==null?void 0:a.type)})<r.matched.length-1:!1}const ke=["id"],Re={key:1},be=T({name:"SearchPage",__name:"search",async setup(t){let r,a;const c=B(),n=le(),o=oe(),i=se(),f=J(),{searchTerm:s,searchType:l,apiSearchQueryParams:g}=ne(i),e=_(()=>o.fetchState.error),y=_(()=>o.isFetching),v=x(`${s.value} | Openverse`);j(s,()=>{v.value=`${s.value} | Openverse`}),me(()=>({title:v.value}));const d=x(O(l.value)?o.searchResults:null),p=async(u={})=>{if(!O(l.value)||o.fetchState.status!=="idle"&&e.value!==null&&!ue(e.value))return;u.shouldPersistMedia||(d.value={type:l.value,items:[]});const m=await o.fetchMedia(u);return!e.value||ce(e.value)?(d.value=m,m):e.value};pe(g,(u,h)=>{ie(u,h)||U(i.getSearchPath())},{debounce:800,maxWait:5e3});const S=_(()=>f.query),R=_(()=>f.path),b=_(()=>n.isOn("fetch_sensitive")),E=async()=>{await p({shouldPersistMedia:!0})};return[r,a]=Q(async()=>fe("search",async()=>{var m;if(c.isHydrating)return d.value;(m=document.getElementById("main-page"))==null||m.scroll(0,0);const u=await p(),h=u?"requestKind"in u?u:null:e.value??"Fetch media error";return h?te(h):u},{server:!1,watch:[b,S,R]})),await r,a(),(u,h)=>{const m=ge;return w(),F("div",{id:H(re),tabindex:"-1",class:"browse-page flex w-full flex-col px-6 lg:px-10"},[e.value?(w(),V(de,{key:0,"fetching-error":e.value,class:"w-full py-10"},null,8,["fetching-error"])):(w(),F("div",Re,[P(m,{"page-key":(u._.provides[I]||u.$route).path,results:d.value,"is-fetching":y.value,"search-term":H(s),"handle-load-more":E,"data-testid":"search-results"},null,8,["page-key","results","is-fetching","search-term"])]))],8,ke)}}});be.__docgenInfo={name:"SearchPage",exportName:"default",displayName:"search",description:"",tags:{},sourceFiles:["/home/runner/work/openverse/openverse/frontend/src/pages/search.vue"]};export{be as default};
