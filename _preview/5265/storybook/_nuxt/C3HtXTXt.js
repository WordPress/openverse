import{_ as ve}from"./DXIOb9i7.js";import{_ as he}from"./DKDb4atL.js";import{d as be,W as m,c as w,r as v,w as L,k as ge,L as $,l as Se,u as t,J as h,K as b,e as c,O as E,P as y,Q as we,N as ye,M as _e,D as xe,E as q,I as ke,j as G,n as Ce}from"./DwwldUEF.js";import{o as Ie}from"./Ck0CgHQL.js";import{C as Re,R as Te}from"./DpnpvZCo.js";import{s as Be}from"./CUvT7aun.js";import{f as $e}from"./Bkc2CSET.js";import{e as z,g as Ee,a as Fe}from"./DZP0BHtF.js";import{f as Ve}from"./Co6bLswe.js";import{u as De,a as Me}from"./Ds_kB4O7.js";import{u as Ne}from"./CUuqYMuc.js";import{u as Oe}from"./O68K-DQz.js";import{u as He}from"./CEvcS2ii.js";import{u as Ke}from"./CYeZhaSj.js";import{_ as Ae}from"./CQSVRgMH.js";import{_ as Pe}from"./uHU1XEUv.js";import{_ as Le}from"./CBxfnFhK.js";import{_ as qe}from"./BHjeR4Hq.js";import{V as j}from"./DM9lyHMg.js";import{u as Ge}from"./VcnMPoS3.js";import{u as ze,a as je}from"./BtS8wA1z.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},g=new u.Error().stack;g&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[g]="73c6d2bf-b952-4fe0-a72c-3f5977e796b1",u._sentryDebugIdIdentifier="sentry-dbid-73c6d2bf-b952-4fe0-a72c-3f5977e796b1")}catch{}})();const Je=["placeholder","value","aria-label","aria-expanded","aria-activedescendant"],Qe=be({__name:"VHeaderMobile",emits:["open","close"],setup(u,{emit:g}){const d=m("searchInputRef"),_=m("headerRef"),x=m("recentSearchesRef"),F=m("contentSettingsButtonRef"),J=w(()=>{var e;return((e=F.value)==null?void 0:e.$el)??void 0}),Q=m("clearButtonRef"),W=De(),U=Me(),f=v(!1),r=v(!1),k=v(!1),X=w(()=>U.appliedFilterCount),V=w(()=>W.fetchState.isFetching),C=v({start:0,end:0}),{$sendCustomEvent:Y}=Ge(),{updateSearchState:Z,searchTerm:p,searchStatus:D}=Oe(Y),n=v(p.value),M=()=>{const e=d.value;e&&(z(e),e.selectionStart=C.value.start,e.selectionEnd=C.value.end)},ee=()=>{n.value&&n.value!==p.value&&(p.value=n.value),I(),N()},N=()=>{window.scrollTo({top:0,left:0,behavior:"auto"}),Z()},O=()=>{r.value=!0,f.value=!0,o.value||se()},S=()=>{r.value=!1,f.value=!1},H=()=>{const e=d.value;if(!e)return;const a=e.value.length>0?e.value.length-1:0;C.value={start:e.selectionStart??a,end:e.selectionEnd??a}},te=()=>{const e=d.value;e&&(n.value=e.value,H(),r.value&&!f.value&&O())},ae=()=>{n.value="",M()},{handleKeydown:K,handleSelect:ne,handleClear:oe,recent:{isVisible:o,show:se,hide:I,entries:re,selectedIdx:R}}=Ke({focusInput:M,term:n,isMobile:!0,isInputFocused:r});L(o,e=>{e||(S(),n.value!==p.value&&(p.value=n.value,N()))});const le=()=>r.value=!0,ie=()=>{!o.value&&r.value&&S()};Ie(_,e=>{var s,l;((l=(s=x.value)==null?void 0:s.$el)==null?void 0:l.contains(e.target))||(r.value=!1)});const ce=()=>{f.value||(H(),O())},T=e=>{I(),Ce().then(()=>{const a=e==="forward"?document.getElementById(Be):Ee(document.body)[1];z(a??Fe(document.body))})},ue=g,{close:A,onTriggerClick:de,triggerA11yProps:fe}=Ne({id:Re,visibleRef:k,nodeRef:_,lockBodyScroll:!0,emit:ue}),B=ze(),pe=w(()=>$e(B==null?void 0:B.query.q));L(pe,e=>{n.value=e??""});const{doneHydrating:me}=He();je().beforeEach((e,a,s)=>{e.path!==a.path&&(A(),S()),s()});const P=(e,a)=>{var s;if(o.value){e.preventDefault();const l=(s=x.value)==null?void 0:s.$el;l&&Ve(l,1)}else a==="content-settings"&&T("forward")};return(e,a)=>{const s=ve,l=he;return G(),ge("header",{ref_key:"headerRef",ref:_,class:"main-header z-30 flex w-full items-center px-6 py-4"},[$("form",{action:"/search",class:_e(["search-bar group flex h-12 w-full flex-row items-center overflow-hidden rounded-sm",f.value||r.value?"bg-default ring ring-focus":"bg-surface"]),onSubmit:y(ee,["prevent"])},[Se(e.$slots,"start",{},()=>[h(c(Ae,{"is-fetching":V.value,class:"focus-visible:me-1.5px focus-visible:ms-1.5px focus-visible:!h-[45px] focus-visible:max-w-[45px]"},null,8,["is-fetching"]),[[b,!t(o)]]),h(c(j,{icon:"chevron-back",label:e.$t("header.backButton"),"rtl-flip":!0,variant:"filled-gray",onClick:t(I),onKeydown:a[0]||(a[0]=E(y(i=>T("backward"),["shift"]),["tab"]))},null,8,["label","onClick"]),[[b,t(o)]])]),$("input",{id:"search-bar",ref_key:"searchInputRef",ref:d,name:"q",placeholder:e.$t("hero.search.placeholder"),type:"search",class:"search-field ms-1 h-full w-full flex-grow appearance-none rounded-none border-tx bg-tx text-2xl text-secondary placeholder-default hover:text-default focus-visible:outline-none",value:n.value,"aria-label":e.$t("search.searchBarLabel",{openverse:"Openverse"}),autocomplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":t(o)?"true":"false","aria-controls":"recent-searches-list","aria-haspopup":"listbox","aria-activedescendant":t(R)===void 0?void 0:`option-${t(R)}`,onInput:te,onKeydown:a[1]||(a[1]=(...i)=>t(K)&&t(K)(...i)),onFocus:le,onFocusout:ie,onClick:ce},null,40,Je),h(c(j,{ref_key:"clearButtonRef",ref:Q,icon:"close-small",label:e.$t("browsePage.searchForm.clear"),onClick:ae,onKeydown:a[2]||(a[2]=E(y(i=>P(i,"clear-input"),["exact"]),["tab"]))},null,8,["label"]),[[b,t(o)&&n.value]]),h($("span",{class:"info mx-4 hidden whitespace-nowrap text-xs group-hover:text-default group-focus:text-default md:flex"},we(t(D)),513),[[b,!f.value&&t(D)]]),h(c(Le,ye({ref_key:"contentSettingsButtonRef",ref:F,"is-pressed":k.value,"applied-filter-count":X.value},t(fe),{disabled:!t(me),onClick:t(de),onKeydown:a[3]||(a[3]=E(y(i=>P(i,"content-settings"),["exact"]),["tab"]))}),null,16,["is-pressed","applied-filter-count","disabled","onClick"]),[[b,!t(o)]]),c(Pe,{variant:"two-thirds",visible:k.value,"is-fetching":V.value,close:t(A),"trigger-element":J.value,labelledby:"content-settings-button"},null,8,["visible","is-fetching","close","trigger-element"])],34),t(o)?(G(),xe(l,{key:0,id:t(Te),visible:!0,hide:S,"trigger-element":t(d),"trap-focus":!1,"auto-focus-on-show":!1,"auto-focus-on-hide":!1,"content-classes":"px-3","aria-label":e.$t("recentSearches.heading"),variant:"mobile-input"},{default:q(()=>[c(s,null,{default:q(()=>[c(qe,{ref_key:"recentSearchesRef",ref:x,class:"w-[100dvw] px-3","selected-idx":t(R),entries:t(re),bordered:!1,onSelect:t(ne),onClear:t(oe),onLastTab:a[4]||(a[4]=i=>T("forward"))},null,8,["selected-idx","entries","onSelect","onClear"])]),_:1})]),_:1},8,["id","trigger-element","aria-label"])):ke("",!0)],512)}}});Qe.__docgenInfo={exportName:"default",displayName:"VHeaderMobile",description:"",tags:{},events:[{name:"open"},{name:"close"}],slots:[{name:"start"}],sourceFiles:["/home/runner/work/openverse/openverse/frontend/src/components/VHeader/VHeaderMobile/VHeaderMobile.vue"]};export{Qe as _};
