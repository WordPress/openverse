{"version":3,"file":"BGi7wlVR.js","sources":["../../src/components/VMediaInfo/VByLine/VScroller.vue","../../src/components/VScrollableLine.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useI18n } from \"#imports\"\nimport { computed } from \"vue\"\n\nimport VIconButton from \"~/components/VIconButton/VIconButton.vue\"\n\nconst props = defineProps<{ direction: \"forward\" | \"back\" }>()\n\ndefineEmits<{ click: [] }>()\n\nconst { t } = useI18n({ useScope: \"global\" })\n\nconst iconName = computed(() =>\n  props.direction === \"forward\" ? \"chevron-forward\" : \"chevron-back\"\n)\n\nconst label = computed(() =>\n  t(\n    props.direction === \"forward\"\n      ? \"mediaDetails.scroll.forward\"\n      : \"mediaDetails.scroll.back\"\n  )\n)\n</script>\n\n<template>\n  <div class=\"absolute z-10 h-8 w-8 flex-none\">\n    <VIconButton\n      :icon-props=\"{ name: iconName, rtlFlip: true }\"\n      :label=\"label\"\n      variant=\"transparent-gray\"\n      size=\"small\"\n      @click=\"$emit('click')\"\n    />\n  </div>\n</template>\n","<script setup lang=\"ts\">\n/**\n * A link to a collection page, either a source or a creator.\n */\nimport { useI18n } from \"#imports\"\nimport { computed, onMounted, reactive, ref } from \"vue\"\n\nimport { useElementSize, useScroll, watchDebounced } from \"@vueuse/core\"\n\nimport VScroller from \"~/components/VMediaInfo/VByLine/VScroller.vue\"\n\nconst containerRef = ref<HTMLElement | null>(null)\nconst buttonsRef = ref<HTMLElement | null>(null)\nconst innerContainerRef = ref<HTMLElement | null>(null)\n\nconst { localeProperties } = useI18n({ useScope: \"global\" })\nconst dir = computed(() => localeProperties.value.dir ?? \"ltr\")\n\nconst scrollStep = 150 // px to scroll on each click\nconst scrollMargin = 44 // px, button + margin\nconst shouldScroll = ref(false)\n\nconst { x } = useScroll(buttonsRef)\nconst { width: containerWidth } = useElementSize(containerRef)\n\nconst showScrollButton = reactive({\n  start: false,\n  end: false,\n})\nconst setScrollable = () => {\n  shouldScroll.value = true\n  showScrollButton.start = false\n  showScrollButton.end = true\n}\n\nconst hideScrollButton = (side: \"start\" | \"end\") => {\n  showScrollButton[side] = false\n  isInteractive.value = false\n  setTimeout(() => {\n    isInteractive.value = true\n  }, 500)\n}\nconst isInteractive = ref(true)\n\nwatchDebounced(\n  containerWidth,\n  (cWidth) => {\n    const buttonsScrollWidth = buttonsRef.value?.scrollWidth ?? 0\n    const hasOverflow = buttonsScrollWidth >= cWidth\n    if (hasOverflow && !shouldScroll.value) {\n      setScrollable()\n    } else if (!hasOverflow && shouldScroll.value) {\n      shouldScroll.value = false\n      showScrollButton.start = false\n      showScrollButton.end = false\n    }\n  },\n  { debounce: 500 }\n)\n\nonMounted(() => {\n  if (!buttonsRef.value || !containerRef.value) {\n    return\n  }\n  if (buttonsRef.value?.scrollWidth > containerRef.value.scrollWidth) {\n    setScrollable()\n  }\n})\n\nconst getScrollEnd = (el: HTMLElement, dir: \"ltr\" | \"rtl\" | \"auto\") => {\n  return (\n    el.scrollWidth -\n    el.clientWidth -\n    (dir === \"rtl\" ? -el.scrollLeft : el.scrollLeft)\n  )\n}\nconst getScrollStart = (el: HTMLElement) => {\n  return Math.abs(el.scrollLeft)\n}\n\nconst getDistToSide = (\n  to: \"start\" | \"end\",\n  dir: \"ltr\" | \"rtl\" | \"auto\",\n  el: HTMLElement\n) => {\n  return to === \"start\" ? getScrollStart(el) : getScrollEnd(el, dir)\n}\n\nconst scrollToSide = ({ side }: { side: \"start\" | \"end\" }) => {\n  hideScrollButton(side)\n  if (!buttonsRef.value) {\n    return\n  }\n  const left =\n    side === \"start\"\n      ? 0\n      : dir.value === \"ltr\"\n        ? buttonsRef.value.scrollWidth\n        : -buttonsRef.value.scrollWidth\n  buttonsRef.value.scrollTo({ left, behavior: \"smooth\" })\n}\n\nconst scroll = (to: \"start\" | \"end\") => {\n  if (!buttonsRef.value || !innerContainerRef.value) {\n    return\n  }\n  const innerContainer = innerContainerRef.value\n\n  showScrollButton[to === \"start\" ? \"end\" : \"start\"] = true\n\n  const distToSide = getDistToSide(to, dir.value, innerContainer)\n  let adjustedScrollStep = scrollStep\n\n  // If the scroll step is larger than the distance to the side, scroll\n  // to the side and hide the scroll button.\n  // If the distance to the side is less than twice the scroll step, scroll\n  // half the distance to the side to prevent a very small scroll at the end.\n  const isLastScroll = distToSide - scrollMargin <= scrollStep\n  if (isLastScroll) {\n    scrollToSide({ side: to })\n    return\n  }\n  if (distToSide < scrollStep * 2) {\n    adjustedScrollStep = distToSide / 2\n  }\n  if (dir.value === \"rtl\") {\n    adjustedScrollStep = -adjustedScrollStep\n  }\n\n  const left = to === \"start\" ? -adjustedScrollStep : adjustedScrollStep\n  buttonsRef.value?.scrollBy({ left, behavior: \"smooth\" })\n}\n\nwatchDebounced(\n  x,\n  (xValue) => {\n    if (!buttonsRef.value) {\n      return\n    }\n    // This is necessary for handling both RTL and LTR.\n    const distFromStart = Math.abs(xValue)\n    const distFromEnd =\n      buttonsRef.value.scrollWidth -\n      distFromStart -\n      buttonsRef.value.clientWidth\n    showScrollButton.start = distFromStart >= scrollMargin\n    showScrollButton.end = distFromEnd >= scrollMargin\n  },\n  { debounce: 100 }\n)\n</script>\n\n<template>\n  <div\n    ref=\"containerRef\"\n    class=\"container relative flex min-w-0\"\n    :class=\"{ 'pointer-events-none': !isInteractive }\"\n  >\n    <div\n      ref=\"innerContainerRef\"\n      class=\"inner-container max-w-full\"\n      :class=\"{\n        'faded-overflow-s': showScrollButton.start,\n        'faded-overflow-e': showScrollButton.end,\n      }\"\n    >\n      <div\n        ref=\"buttonsRef\"\n        class=\"buttons flex justify-start gap-x-3 overflow-x-scroll sm:gap-x-1\"\n        :class=\"[\n          showScrollButton.start\n            ? showScrollButton.end\n              ? 'me-11 ms-11 w-[calc(100%_-_2_*_theme(spacing.11))]'\n              : 'ms-11 w-[calc(100%_-_theme(spacing.11))]'\n            : showScrollButton.end\n              ? 'me-11 w-[calc(100%_-_theme(spacing.11))]'\n              : '',\n        ]\"\n      >\n        <slot />\n      </div>\n    </div>\n    <VScroller\n      v-show=\"showScrollButton.start\"\n      class=\"start-0\"\n      direction=\"back\"\n      @click=\"scroll('start')\"\n    />\n    <VScroller\n      v-show=\"showScrollButton.end\"\n      class=\"end-0\"\n      direction=\"forward\"\n      @click=\"scroll('end')\"\n    />\n  </div>\n</template>\n\n<style scoped>\n.buttons::-webkit-scrollbar {\n  width: 0 !important;\n  height: 0 !important;\n}\n.buttons {\n  scrollbar-width: none;\n}\n\n.faded-overflow-e:dir(ltr),\n.faded-overflow-s:dir(rtl) {\n  mask-image: linear-gradient(\n    to left,\n    transparent 0,\n    transparent 44px,\n    #000 98px,\n    #000 100%\n  );\n}\n.faded-overflow-e:dir(rtl),\n.faded-overflow-s:dir(ltr) {\n  mask-image: linear-gradient(\n    to right,\n    transparent 0,\n    transparent 44px,\n    #000 98px,\n    #000 100%\n  );\n}\n\n.faded-overflow-e.faded-overflow-s {\n  mask-image: linear-gradient(\n      to right,\n      transparent 0,\n      transparent 44px,\n      #000 98px,\n      #000 50%,\n      transparent 50%,\n      transparent 100%\n    ),\n    linear-gradient(\n      to left,\n      transparent 0,\n      transparent 44px,\n      #000 98px,\n      #000 50%,\n      transparent 50%,\n      transparent 100%\n    );\n}\n</style>\n"],"names":["props","__props","useI18n","iconName","computed","label","scrollStep","scrollMargin","containerRef","ref","buttonsRef","innerContainerRef","localeProperties","dir","shouldScroll","x","useScroll","containerWidth","useElementSize","showScrollButton","reactive","setScrollable","hideScrollButton","side","isInteractive","watchDebounced","cWidth","hasOverflow","_a","onMounted","getScrollEnd","el","getScrollStart","getDistToSide","to","scrollToSide","left","scroll","innerContainer","distToSide","adjustedScrollStep","xValue","distFromStart","distFromEnd"],"mappings":"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"}