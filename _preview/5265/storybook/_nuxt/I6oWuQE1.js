import{d as k,p as v,b as F}from"./Z8zkSHZ1.js";import{f as I}from"./Ck0CgHQL.js";import"./CWoQmekT.js";import{w as c}from"./TLA9Fm80.js";import{t as _}from"./VcnMPoS3.js";import{u as h}from"./C8BbUAkk.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="3407bf0f-6f79-40f4-9655-a6f92b03c1ca",t._sentryDebugIdIdentifier="sentry-dbid-3407bf0f-6f79-40f4-9655-a6f92b03c1ca")}catch{}})();const C={fake_sensitive:{status:{staging:"switchable",production:"disabled"},description:"Mark 50% of results as sensitive to test content safety.",defaultState:"off",storage:"cookie"},additional_search_types:{status:{staging:"switchable",production:"disabled"},description:"Toggle additional search types in the content switcher.",defaultState:"off",storage:"cookie"},analytics:{status:"switchable",defaultState:"on",description:"Record custom events and page views.",storage:"cookie"},fetch_sensitive:{status:"switchable",defaultState:"off",description:"Show results marked as sensitive in the results area.",supportsQuery:!1,storage:"session"},dark_mode_ui_toggle:{status:{staging:"switchable",production:"enabled"},defaultState:"on",description:"Display the UI toggle to change the site color theme and respect system preferences.",storage:"cookie"}},A=[{title:"analytics",features:["analytics"]}],d={features:C,groups:A},y="enabled",f="disabled",i="switchable",S=[y,f,i],u="on",l="off",b="session",w="cookie",T="local",D="staging",N="production",o=[T,D,N],n=t=>Object.keys(d.features).includes(t),E=(t,e)=>{if(typeof t.status=="string")return S.includes(t.status)?t.status:(c(`Invalid ${t.description} flag status: ${t.status}`),f);{const s=o.indexOf(e);for(let r=s;r<o.length;r+=1)if(o[r]in t.status)return S.includes(t.status[o[r]])?t.status[o[r]]:(c(`Invalid ${t.description} flag status: ${t.status[o[r]]}`),f)}return f},L=(t,e)=>{const s=E(t,e);return s===i?"preferredState"in t?t.preferredState??t.defaultState??l:t.defaultState??l:s===y?u:l},$=t=>({flags:Object.entries(d.features).reduce((s,[r,a])=>(s[r]={...a,name:r,state:L(a,t),status:E(a,t),preferredState:void 0},s),{}),groups:d.groups}),m="feature_flag",V=k(m,{state:()=>{const t=_();if(t)return $(t.$config.public.deploymentEnv);throw new Error("Could not set up feature flag store because Nuxt content isn't available.")},getters:{featureState:t=>e=>n(e)?t.flags[e].state:(c(`Invalid feature flag accessed: ${e}`),u),flagStateMap:t=>e=>{const s={};return Object.entries(t.flags).forEach(([r,a])=>{a.status===i&&a.preferredState!==void 0&&a.storage===e&&(s[r]=a.state)}),s}},actions:{getFlagsBySwitchable(t){return Object.entries(this.flags).filter(e=>e[1].status===i===t).map(e=>e[1])},getFeatureGroups(){const t=[];for(const{title:e,features:s}of this.groups)s.length!==0&&t.push({title:e,features:s.map(r=>this.flags[r])});return t},initFromCookies(t){Object.entries(t).forEach(([e,s])=>{const r=this.flags[e];r&&r.status===i&&this.setPreferredState(e,s)})},writeToCookie(){const t=h("features",v);t.value=this.flagStateMap(w)},writeToSession(){const t=h("sessionFeatures",F);t.value=this.flagStateMap(b)},initFromQuery(t){const e=a=>a.startsWith("ff_")&&a.replace("ff_","")in this.flags,s=a=>typeof a=="string"&&["on","off"].includes(a),r=a=>e(a[0])&&s(a[1]);Object.entries(t).filter(r).forEach(([a,O])=>{const g=a.substring(3),p=this.flags[g];p.status===i&&p.supportsQuery!==!1&&this.setPreferredState(g,O)})},setPreferredState(t,e){const s=this.flags[t];s.status===i&&(s.preferredState=e,s.state=e)},updateStorage(t){const e=this.flags[t];e.storage===w?this.writeToCookie():e.storage===b&&this.writeToSession(),t==="analytics"&&this.syncAnalyticsWithLocalStorage()},toggleFeature(t,e){if(!n(t))throw new Error(`Toggling invalid feature flag: ${t}`);this.flags[t].status===i?(this.setPreferredState(t,e),this.updateStorage(t)):c(`Cannot set preferred state for non-switchable flag: ${t}`)},syncAnalyticsWithLocalStorage(){const t=I("plausible_ignore",null);t.value=this.flags.analytics.state===u?null:!0},isSwitchable(t){if(!n(t))throw new Error(`Invalid feature flag accessed: ${t}`);return this.flags[t].status===i},isOn(t){if(!n(t))throw new Error(`Invalid feature flag accessed: ${t}`);return this.flags[t].state===u}}});export{u as O,i as S,l as a,d as f,V as u};
