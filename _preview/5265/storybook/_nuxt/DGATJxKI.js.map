{"version":3,"file":"DGATJxKI.js","sources":["../../shared/constants/content-report.ts","../../src/composables/use-content-report.ts","../../src/components/VContentReport/VReportDescForm.vue","../../src/components/VContentReport/VContentReportForm.vue"],"sourcesContent":["export const DMCA = \"dmca\"\nexport const SENSITIVE = \"sensitive\"\nexport const OTHER = \"other\"\n\nexport const reasons = [DMCA, SENSITIVE, OTHER] as const\n\nexport type ReportReason = (typeof reasons)[number]\n\nexport const SENT = \"sent\"\nexport const FAILED = \"failed\"\nexport const WIP = \"wip\"\n\nexport const statuses = [SENT, FAILED, WIP] as const\n\nexport type ReportStatus = (typeof statuses)[number]\n\nexport const DMCA_FORM_URL =\n  \"https://docs.google.com/forms/d/e/1FAIpQLSd0I8GsEbGQLdaX4K_F6V2NbHZqN137WMZgnptUpzwd-kbDKA/viewform\"\n","import { useI18n } from \"#imports\"\nimport { computed, ref } from \"vue\"\n\nimport { type ReportStatus, SENT, WIP } from \"#shared/constants/content-report\"\n\nexport const useContentReport = () => {\n  const status = ref<ReportStatus>(WIP)\n\n  const updateStatus = (newStatus: ReportStatus) => {\n    status.value = newStatus\n  }\n\n  const { t } = useI18n({ useScope: \"global\" })\n\n  const title = computed(() => {\n    return status.value === WIP\n      ? t(\"mediaDetails.contentReport.long\")\n      : status.value === SENT\n        ? t(\"mediaDetails.contentReport.success.title\")\n        : t(\"mediaDetails.contentReport.failure.title\")\n  })\n\n  return {\n    status,\n    updateStatus,\n    title,\n  }\n}\n","<script setup lang=\"ts\">\nimport { computed } from \"vue\"\n\nimport { OTHER, type ReportReason } from \"#shared/constants/content-report\"\n\nconst props = withDefaults(\n  defineProps<{\n    /**\n     * the contents of the textarea\n     */\n    content?: string\n    /**\n     * the reason selected for reporting the content\n     */\n    reason: ReportReason\n  }>(),\n  {\n    content: \"\",\n  }\n)\n\nconst emit = defineEmits<{ \"update:content\": [string] }>()\n\nconst text = computed({\n  get: () => props.content,\n  set: (val) => emit(\"update:content\", val),\n})\n\nconst isRequired = computed(() => props.reason === OTHER)\n</script>\n\n<template>\n  <label class=\"other-form min-h-[7rem]\" for=\"description\">\n    <span class=\"flex flex-row items-center justify-between\">\n      <span>{{ $t(\"mediaDetails.contentReport.form.other.note\") }}</span>\n      <span>{{\n        $t(`mediaDetails.contentReport.form.${reason}.subLabel`)\n      }}</span>\n    </span>\n    <textarea\n      id=\"description\"\n      v-model=\"text\"\n      class=\"placeholder-text-secondary mt-2 h-20 w-full rounded-sm border border-tertiary bg-default p-2 text-default focus-visible:border-focus disabled:bg-surface\"\n      :placeholder=\"$t(`mediaDetails.contentReport.form.${reason}.placeholder`)\"\n      :required=\"isRequired\"\n      :minlength=\"isRequired ? 20 : 0\"\n      maxlength=\"500\"\n    />\n  </label>\n</template>\n","<script setup lang=\"ts\">\nimport { useNuxtApp, useRuntimeConfig } from \"#imports\"\nimport { computed, ref } from \"vue\"\n\nimport { ofetch } from \"ofetch\"\n\nimport {\n  reasons,\n  DMCA,\n  OTHER,\n  SENT,\n  FAILED,\n  DMCA_FORM_URL,\n  type ReportReason,\n  type ReportStatus,\n} from \"#shared/constants/content-report\"\nimport { mediaSlug } from \"#shared/utils/query-utils\"\nimport type { ReportableMedia } from \"#shared/types/media\"\n\nimport VButton from \"~/components/VButton.vue\"\nimport VRadio from \"~/components/VRadio/VRadio.vue\"\nimport VDmcaNotice from \"~/components/VContentReport/VDmcaNotice.vue\"\nimport VReportDescForm from \"~/components/VContentReport/VReportDescForm.vue\"\nimport VLink from \"~/components/VLink.vue\"\n\nconst props = defineProps<{\n  media: ReportableMedia\n  status: ReportStatus\n  allowCancel: boolean\n}>()\n\nconst emit = defineEmits<{\n  close: []\n  \"update-status\": [ReportStatus]\n}>()\n\nconst selectedReason = ref<ReportReason>(DMCA)\nconst description = ref(\"\")\n\nconst resetForm = () => {\n  selectedReason.value = DMCA\n  description.value = \"\"\n}\n\nconst reportUrl = computed(() => {\n  const apiUrl = useRuntimeConfig().public.apiUrl\n  return `${apiUrl}v1/${mediaSlug(props.media.frontendMediaType)}/${props.media.id}/report/`\n})\nconst dmcaFormUrl = computed(\n  () =>\n    `${DMCA_FORM_URL}?entry.917669540=https://openverse.org/${props.media.frontendMediaType}/${props.media.id}`\n)\n\n/* Buttons */\nconst handleCancel = () => {\n  resetForm()\n  emit(\"close\")\n}\n\nconst isSubmitDisabled = computed(\n  () => selectedReason.value === OTHER && description.value.length < 20\n)\n\nconst { $sendCustomEvent } = useNuxtApp()\n\nconst handleDmcaSubmit = () => {\n  updateStatus(SENT)\n}\n\nconst handleSubmit = async (event: Event) => {\n  event.preventDefault()\n  try {\n    await ofetch(reportUrl.value, {\n      method: \"POST\",\n      body: {\n        mediaType: props.media.frontendMediaType,\n        reason: selectedReason.value,\n        identifier: props.media.id,\n        description: description.value,\n      },\n    })\n    updateStatus(SENT)\n  } catch {\n    updateStatus(FAILED)\n  }\n}\n\nconst updateStatus = (newStatus: ReportStatus) => {\n  if (newStatus === SENT) {\n    $sendCustomEvent(\"REPORT_MEDIA\", {\n      id: props.media.id,\n      mediaType: props.media.frontendMediaType,\n      provider: props.media.provider,\n      reason: selectedReason.value,\n    })\n  }\n  emit(\"update-status\", newStatus)\n}\n\ndefineExpose({ resetForm })\n</script>\n\n<template>\n  <div id=\"content-report-form\">\n    <div v-if=\"status === SENT\">\n      <i18n-t\n        scope=\"global\"\n        keypath=\"mediaDetails.contentReport.success.note\"\n        class=\"text-sm\"\n        tag=\"p\"\n      >\n        <template #source>\n          <VLink\n            :href=\"media.foreign_landing_url\"\n            class=\"text-link hover:underline\"\n            >{{ media.providerName }}</VLink\n          >\n        </template>\n      </i18n-t>\n    </div>\n\n    <div v-else-if=\"status === FAILED\">\n      <p class=\"text-sm\">\n        {{ $t(\"mediaDetails.contentReport.failure.note\") }}\n      </p>\n    </div>\n\n    <!-- Main form -->\n    <div v-else>\n      <p class=\"mb-4 text-sm leading-normal\">\n        {{\n          $t(\"mediaDetails.contentReport.form.disclaimer\", {\n            openverse: \"Openverse\",\n          })\n        }}\n      </p>\n\n      <form class=\"flex flex-col gap-y-4 text-sm\" @submit=\"handleSubmit\">\n        <fieldset class=\"flex flex-col gap-y-4\">\n          <legend class=\"label-bold mb-4\">\n            {{ $t(\"mediaDetails.contentReport.form.question\") }}\n          </legend>\n          <VRadio\n            v-for=\"reason in reasons\"\n            :id=\"reason\"\n            :key=\"reason\"\n            v-model=\"selectedReason\"\n            name=\"reason\"\n            :value=\"reason\"\n          >\n            {{ $t(`mediaDetails.contentReport.form.${reason}.option`) }}\n          </VRadio>\n        </fieldset>\n\n        <div class=\"leading-normal\">\n          <VDmcaNotice\n            v-if=\"selectedReason === DMCA\"\n            :provider=\"media.providerName\"\n            :foreign-landing-url=\"media.foreign_landing_url\"\n            @click=\"handleDmcaSubmit\"\n          />\n          <VReportDescForm\n            v-else\n            key=\"other\"\n            v-model:content=\"description\"\n            :reason=\"selectedReason\"\n            :is-required=\"selectedReason === OTHER\"\n          />\n        </div>\n\n        <div class=\"flex flex-row items-center justify-end gap-x-4\">\n          <VButton\n            v-if=\"allowCancel\"\n            variant=\"bordered-gray\"\n            size=\"medium\"\n            class=\"label-bold\"\n            @click=\"handleCancel\"\n          >\n            {{ $t(\"mediaDetails.contentReport.form.cancel\") }}\n          </VButton>\n\n          <VButton\n            v-if=\"selectedReason === DMCA\"\n            key=\"dmca\"\n            as=\"VLink\"\n            variant=\"filled-dark\"\n            size=\"medium\"\n            class=\"label-bold\"\n            has-icon-end\n            show-external-icon\n            :external-icon-size=\"6\"\n            :href=\"dmcaFormUrl\"\n            :send-external-link-click-event=\"false\"\n            target=\"_blank\"\n            @click=\"handleDmcaSubmit\"\n          >\n            {{ $t(\"mediaDetails.contentReport.form.dmca.open\") }}\n          </VButton>\n          <VButton\n            v-else\n            key=\"non-dmca\"\n            type=\"submit\"\n            :disabled=\"isSubmitDisabled\"\n            :focusable-when-disabled=\"true\"\n            variant=\"filled-dark\"\n            size=\"medium\"\n            class=\"label-bold\"\n            :value=\"$t('mediaDetails.contentReport.form.submit')\"\n          >\n            {{ $t(\"mediaDetails.contentReport.form.submit\") }}\n          </VButton>\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n"],"names":["DMCA","SENSITIVE","OTHER","reasons","SENT","FAILED","WIP","DMCA_FORM_URL","useContentReport","status","ref","updateStatus","newStatus","t","useI18n","title","computed","props","__props","emit","__emit","text","val","isRequired","selectedReason","description","resetForm","reportUrl","useRuntimeConfig","mediaSlug","dmcaFormUrl","handleCancel","isSubmitDisabled","$sendCustomEvent","useNuxtApp","handleDmcaSubmit","handleSubmit","event","ofetch","__expose"],"mappings":"0tBAAO,MAAMA,EAAO,OACPC,GAAY,YACZC,EAAQ,QAERC,GAAU,CAACH,EAAMC,GAAWC,CAAK,EAIjCE,EAAO,OACPC,EAAS,SACTC,EAAM,MAMNC,EACX,sGCZWC,GAAmB,IAAM,CAC9B,MAAAC,EAASC,EAAkBJ,CAAG,EAE9BK,EAAgBC,GAA4B,CAChDH,EAAO,MAAQG,CACjB,EAEM,CAAE,EAAAC,CAAE,EAAIC,EAAQ,CAAE,SAAU,SAAU,EAEtCC,EAAQC,EAAS,IACdP,EAAO,QAAUH,EACpBO,EAAE,iCAAiC,EACnCJ,EAAO,QAAUL,EACfS,EAAE,0CAA0C,EAC5CA,EAAE,0CAA0C,CACnD,EAEM,MAAA,CACL,OAAAJ,EACA,aAAAE,EACA,MAAAI,CACF,CACF,u3CCtBA,MAAME,EAAQC,EAgBRC,EAAOC,EAEPC,EAAOL,EAAS,CACpB,IAAK,IAAMC,EAAM,QACjB,IAAMK,GAAQH,EAAK,iBAAkBG,CAAG,CAAA,CACzC,EAEKC,EAAaP,EAAS,IAAMC,EAAM,SAAWf,CAAK,6gDCHxD,MAAMe,EAAQC,EAMRC,EAAOC,EAKPI,EAAiBd,EAAkBV,CAAI,EACvCyB,EAAcf,EAAI,EAAE,EAEpBgB,EAAY,IAAM,CACtBF,EAAe,MAAQxB,EACvByB,EAAY,MAAQ,EACtB,EAEME,EAAYX,EAAS,IAElB,GADQY,KAAmB,OAAO,MACzB,MAAMC,EAAUZ,EAAM,MAAM,iBAAiB,CAAC,IAAIA,EAAM,MAAM,EAAE,UACjF,EACKa,EAAcd,EAClB,IACE,GAAGT,CAAa,0CAA0CU,EAAM,MAAM,iBAAiB,IAAIA,EAAM,MAAM,EAAE,EAC7G,EAGMc,EAAe,IAAM,CACfL,EAAA,EACVP,EAAK,OAAO,CACd,EAEMa,EAAmBhB,EACvB,IAAMQ,EAAe,QAAUtB,GAASuB,EAAY,MAAM,OAAS,EACrE,EAEM,CAAE,iBAAAQ,CAAiB,EAAIC,EAAW,EAElCC,EAAmB,IAAM,CAC7BxB,EAAaP,CAAI,CACnB,EAEMgC,EAAe,MAAOC,GAAiB,CAC3CA,EAAM,eAAe,EACjB,GAAA,CACI,MAAAC,EAAOX,EAAU,MAAO,CAC5B,OAAQ,OACR,KAAM,CACJ,UAAWV,EAAM,MAAM,kBACvB,OAAQO,EAAe,MACvB,WAAYP,EAAM,MAAM,GACxB,YAAaQ,EAAY,KAAA,CAC3B,CACD,EACDd,EAAaP,CAAI,CAAA,MACX,CACNO,EAAaN,CAAM,CAAA,CAEvB,EAEMM,EAAgBC,GAA4B,CAC5CA,IAAcR,GAChB6B,EAAiB,eAAgB,CAC/B,GAAIhB,EAAM,MAAM,GAChB,UAAWA,EAAM,MAAM,kBACvB,SAAUA,EAAM,MAAM,SACtB,OAAQO,EAAe,KAAA,CACxB,EAEHL,EAAK,gBAAiBP,CAAS,CACjC,EAEa,OAAA2B,EAAA,CAAE,UAAAb,EAAW"}