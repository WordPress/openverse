{"version":3,"file":"T_v0JoKF.js","sources":["../../src/components/VSourcesTable.vue","../../src/pages/sources.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { reactive, ref } from \"vue\"\n\nimport type { SupportedMediaType } from \"#shared/constants/media\"\nimport type { MediaProvider } from \"#shared/types/media-provider\"\nimport { useProviderStore } from \"~/stores/provider\"\nimport { useSearchStore } from \"~/stores/search\"\nimport { useGetLocaleFormattedNumber } from \"~/composables/use-get-locale-formatted-number\"\n\nimport TableSortIcon from \"~/components/TableSortIcon.vue\"\nimport VLink from \"~/components/VLink.vue\"\n\nconst props = defineProps<{ media: SupportedMediaType }>()\n\nconst providerStore = useProviderStore()\nconst searchStore = useSearchStore()\n\nconst sorting = reactive({\n  direction: \"asc\",\n  field: \"display_name\" as keyof Omit<MediaProvider, \"logo_url\">,\n})\n\n// The providers in store are sorted by `source_name`, here we sort them by `display_name`.\nconst providers = ref<MediaProvider[]>(\n  providerStore.providers[props.media].sort(compareProviders)\n)\n\nfunction sortTable(field: keyof Omit<MediaProvider, \"logo_url\">) {\n  let direction = field === \"media_count\" ? \"desc\" : \"asc\"\n  if (field === sorting.field) {\n    direction = sorting.direction === \"asc\" ? \"desc\" : \"asc\"\n  }\n\n  sorting.direction = direction\n  sorting.field = field\n\n  const sortedProviders = providers.value.sort(compareProviders)\n\n  providers.value =\n    direction === \"asc\" ? sortedProviders : sortedProviders.reverse()\n}\n\nfunction cleanSourceUrlForPresentation(url: string) {\n  const stripProtocol = (s: string) => s.replace(/https?:\\/\\//, \"\")\n  const stripLeadingWww = (s: string) =>\n    s.startsWith(\"www.\") ? s.replace(\"www.\", \"\") : s\n  const removeAfterSlash = (s: string) => s.split(\"/\")[0]\n\n  return removeAfterSlash(stripLeadingWww(stripProtocol(url)))\n}\n\nconst getLocaleFormattedNumber = useGetLocaleFormattedNumber()\n\nfunction compareProviders(prov1: MediaProvider, prov2: MediaProvider) {\n  let field1 = prov1[sorting.field]\n  let field2 = prov2[sorting.field]\n  if (sorting.field === \"display_name\") {\n    field1 = prov1[sorting.field].toLowerCase()\n    field2 = prov2[sorting.field].toLowerCase()\n  }\n\n  if (sorting.field === \"source_url\") {\n    field1 = cleanSourceUrlForPresentation(field1 as string)\n    field2 = cleanSourceUrlForPresentation(field2 as string)\n  }\n  if (field1 > field2) {\n    return 1\n  }\n  if (field1 < field2) {\n    return -1\n  }\n  return 0\n}\n\nconst providerViewUrl = (provider: MediaProvider) => {\n  return searchStore.getCollectionPath({\n    type: props.media,\n    collectionParams: {\n      collection: \"source\",\n      source: provider.source_name,\n    },\n  })\n}\n</script>\n\n<template>\n  <div>\n    <table\n      :aria-label=\"$t('sources.aria.table')\"\n      role=\"region\"\n      class=\"not-prose source-table w-full table-fixed text-base\"\n    >\n      <thead>\n        <tr>\n          <th\n            tabindex=\"0\"\n            @click=\"sortTable('display_name')\"\n            @keypress.enter=\"sortTable('display_name')\"\n          >\n            <span class=\"flex w-full flex-row items-center justify-between\">\n              {{ $t(\"sources.providers.source\") }}\n              <TableSortIcon :active=\"sorting.field === 'display_name'\" />\n            </span>\n          </th>\n          <th\n            tabindex=\"0\"\n            @click=\"sortTable('source_url')\"\n            @keypress.enter=\"sortTable('source_url')\"\n          >\n            <span class=\"flex w-full flex-row items-center justify-between\">\n              {{ $t(\"sources.providers.domain\") }}\n              <TableSortIcon :active=\"sorting.field === 'source_url'\" />\n            </span>\n          </th>\n          <th\n            tabindex=\"0\"\n            @click=\"sortTable('media_count')\"\n            @keypress.enter=\"sortTable('media_count')\"\n          >\n            <span class=\"flex w-full flex-row items-center justify-between\">\n              {{ $t(\"sources.providers.item\") }}\n              <TableSortIcon :active=\"sorting.field === 'media_count'\" />\n            </span>\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"provider in providers\" :key=\"provider.display_name\">\n          <td>\n            <VLink :href=\"providerViewUrl(provider)\">{{\n              provider.display_name\n            }}</VLink>\n          </td>\n          <td class=\"truncate font-semibold\">\n            <VLink :href=\"provider.source_url\">\n              {{ cleanSourceUrlForPresentation(provider.source_url) }}\n            </VLink>\n          </td>\n          <td class=\"text-right\">\n            {{ getLocaleFormattedNumber(provider.media_count || 0) }}\n          </td>\n        </tr>\n      </tbody>\n    </table>\n\n    <section role=\"region\" class=\"mobile-source-table md:hidden\">\n      <article\n        v-for=\"provider in providers\"\n        :key=\"provider.display_name\"\n        :title=\"provider.display_name\"\n      >\n        <p>{{ $t(\"sources.providers.source\") }}</p>\n\n        <VLink :href=\"providerViewUrl(provider)\">{{\n          provider.display_name\n        }}</VLink>\n\n        <p>{{ $t(\"sources.providers.domain\") }}</p>\n\n        <VLink :href=\"provider.source_url\">\n          {{ cleanSourceUrlForPresentation(provider.source_url) }}\n        </VLink>\n\n        <p>{{ $t(\"sources.providers.item\") }}</p>\n\n        <span>\n          {{ getLocaleFormattedNumber(provider.media_count || 0) }}\n        </span>\n      </article>\n    </section>\n  </div>\n</template>\n\n<style scoped>\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer components {\n  .source-table {\n    @apply hidden rounded-sm border-0 border-default md:table;\n  }\n\n  .source-table th,\n  .source-table td {\n    @apply border-default;\n  }\n\n  .source-table a {\n    @apply text-link hover:underline;\n  }\n\n  .source-table th {\n    @apply cursor-pointer border-t bg-secondary;\n  }\n\n  .source-table th,\n  .source-table td {\n    @apply border-r p-4 first:border-l;\n  }\n\n  .source-table td {\n    @apply break-normal border-y-0;\n  }\n\n  .source-table tr {\n    @apply even:bg-surface;\n  }\n\n  .source-table th {\n    @apply first:rounded-ss-sm last:rounded-se-sm;\n  }\n\n  .source-table tr:last-child td {\n    @apply border-b first:rounded-es-sm last:rounded-ee-sm;\n  }\n\n  .mobile-source-table article {\n    @apply grid border-l border-r border-default p-4 sm:grid-cols-4;\n  }\n\n  .mobile-source-table article:first-child {\n    @apply border-t;\n  }\n\n  .mobile-source-table article:last-child {\n    @apply border-b;\n  }\n\n  .mobile-source-table article:nth-child(odd) {\n    @apply bg-secondary;\n  }\n\n  .mobile-source-table article p {\n    @apply col-span-1 pt-2 font-bold;\n  }\n\n  .mobile-source-table article p:first-child {\n    @apply pt-0;\n  }\n\n  .mobile-source-table article a,\n  .mobile-source-table article span {\n    @apply col-span-3;\n  }\n\n  .mobile-source-table article a {\n    @apply font-bold text-link hover:underline;\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport { definePageMeta, useHead, useNuxtApp } from \"#imports\"\n\nimport { supportedMediaTypes } from \"#shared/constants/media\"\n\nimport VButton from \"~/components/VButton.vue\"\nimport VLink from \"~/components/VLink.vue\"\nimport VContentPage from \"~/components/VContentPage.vue\"\nimport VSourcesTable from \"~/components/VSourcesTable.vue\"\n\ndefineOptions({\n  name: \"SourcesPage\",\n})\n\ndefinePageMeta({\n  layout: \"content-layout\",\n})\n\nconst {\n  $i18n: { t },\n} = useNuxtApp()\n\nuseHead({ title: `${t(\"sources.title\")} | Openverse` })\n</script>\n\n<template>\n  <VContentPage>\n    <h1>\n      {{ $t(\"sources.title\") }}\n    </h1>\n\n    <h2>\n      {{ $t(\"sources.ccContent.where\", { openverse: \"Openverse\" }) }}\n    </h2>\n    <p>\n      {{ $t(\"sources.ccContent.content\", { openverse: \"Openverse\" }) }}\n    </p>\n    <p>\n      <i18n-t scope=\"global\" keypath=\"sources.ccContent.provider.a\" tag=\"span\">\n        <template #flickr>\n          <VLink href=\"https://www.flickr.com/\">Flickr</VLink>\n        </template>\n        <template #smithsonian>\n          <VLink href=\"https://www.si.edu/\">Smithsonian Institute</VLink>\n        </template>\n      </i18n-t>\n      {{ \" \" }}\n      <i18n-t\n        scope=\"global\"\n        keypath=\"sources.ccContent.provider.b\"\n        tag=\"span\"\n      ></i18n-t>\n    </p>\n\n    <i18n-t scope=\"global\" keypath=\"sources.ccContent.europeana\" tag=\"p\">\n      <template #openverse>Openverse</template>\n      <template #link>\n        <VLink href=\"https://www.europeana.eu/en\">Europeana</VLink>\n      </template>\n      <template #linkApi>\n        <VLink href=\"https://pro.europeana.eu/page/apis\"> Europeana API </VLink>\n      </template>\n    </i18n-t>\n\n    <h2>\n      {{ $t(\"sources.newContent.next\") }}\n    </h2>\n    <p>\n      {{ $t(\"sources.newContent.integrate\") }}\n    </p>\n    <ul>\n      <li>\n        {{ $t(\"sources.newContent.impact\") }}\n      </li>\n      <li>\n        {{ $t(\"sources.newContent.reuse\") }}\n      </li>\n      <li>\n        {{ $t(\"sources.newContent.totalItems\") }}\n      </li>\n    </ul>\n\n    <h2>\n      {{ $t(\"sources.suggestions\") }}\n    </h2>\n\n    <p class=\"mt-5 inline-block\">\n      <VButton\n        as=\"VLink\"\n        variant=\"filled-pink-8\"\n        size=\"large\"\n        class=\"not-prose description-bold\"\n        show-external-icon\n        :external-icon-size=\"6\"\n        has-icon-end\n        href=\"https://github.com/WordPress/openverse/issues/new?assignees=&labels=%F0%9F%9A%A6+status%3A+awaiting+triage%2C+%F0%9F%A7%B9+status%3A+ticket+work+required%2C+%E2%98%81%EF%B8%8F+provider%3A+any&template=new-source-suggestion.md&title=[Source+Suggestion]+Insert+source+name+here\"\n      >\n        {{ $t(\"sources.issueButton\") }}\n      </VButton>\n    </p>\n\n    <i18n-t scope=\"global\" keypath=\"sources.detail\" tag=\"p\">\n      <template #singleName>\n        <strong>\n          {{ $t(\"sources.singleName\") }}\n        </strong>\n      </template>\n    </i18n-t>\n    <template v-for=\"(mediaType, i) in supportedMediaTypes\" :key=\"mediaType\">\n      <h3>{{ $t(`sources.heading.${mediaType}`) }}</h3>\n      <VSourcesTable\n        :media=\"mediaType\"\n        class=\"mt-4\"\n        :class=\"i < supportedMediaTypes.length - 1 ? 'mb-10' : ''\"\n      />\n    </template>\n  </VContentPage>\n</template>\n"],"names":["props","__props","providerStore","useProviderStore","searchStore","useSearchStore","sorting","reactive","providers","ref","compareProviders","sortTable","field","direction","sortedProviders","cleanSourceUrlForPresentation","url","s","getLocaleFormattedNumber","useGetLocaleFormattedNumber","prov1","prov2","field1","field2","providerViewUrl","provider","t","useNuxtApp","useHead"],"mappings":"0jFAYA,MAAMA,EAAQC,EAERC,EAAgBC,EAAiB,EACjCC,EAAcC,EAAe,EAE7BC,EAAUC,EAAS,CACvB,UAAW,MACX,MAAO,cAAA,CACR,EAGKC,EAAYC,EAChBP,EAAc,UAAUF,EAAM,KAAK,EAAE,KAAKU,CAAgB,CAC5D,EAEA,SAASC,EAAUC,EAA8C,CAC3D,IAAAC,EAAYD,IAAU,cAAgB,OAAS,MAC/CA,IAAUN,EAAQ,QACRO,EAAAP,EAAQ,YAAc,MAAQ,OAAS,OAGrDA,EAAQ,UAAYO,EACpBP,EAAQ,MAAQM,EAEhB,MAAME,EAAkBN,EAAU,MAAM,KAAKE,CAAgB,EAE7DF,EAAU,MACRK,IAAc,MAAQC,EAAkBA,EAAgB,QAAQ,CAAA,CAGpE,SAASC,EAA8BC,EAAa,CAMlD,OAF0BC,GAAcA,EAAE,MAAM,GAAG,EAAE,CAAC,IAF7BA,GACvBA,EAAE,WAAW,MAAM,EAAIA,EAAE,QAAQ,OAAQ,EAAE,EAAIA,IAF1BA,GAAcA,EAAE,QAAQ,cAAe,EAAE,GAKVD,CAAG,CAAC,CAAC,CAAA,CAG7D,MAAME,EAA2BC,EAA4B,EAEpD,SAAAT,EAAiBU,EAAsBC,EAAsB,CAChE,IAAAC,EAASF,EAAMd,EAAQ,KAAK,EAC5BiB,EAASF,EAAMf,EAAQ,KAAK,EAUhC,OATIA,EAAQ,QAAU,iBACpBgB,EAASF,EAAMd,EAAQ,KAAK,EAAE,YAAY,EAC1CiB,EAASF,EAAMf,EAAQ,KAAK,EAAE,YAAY,GAGxCA,EAAQ,QAAU,eACpBgB,EAASP,EAA8BO,CAAgB,EACvDC,EAASR,EAA8BQ,CAAgB,GAErDD,EAASC,EACJ,EAELD,EAASC,EACJ,GAEF,CAAA,CAGH,MAAAC,EAAmBC,GAChBrB,EAAY,kBAAkB,CACnC,KAAMJ,EAAM,MACZ,iBAAkB,CAChB,WAAY,SACZ,OAAQyB,EAAS,WAAA,CACnB,CACD,sjEC/DG,KAAA,CACJ,MAAO,CAAE,EAAAC,CAAE,GACTC,EAAW,EAEf,OAAAC,EAAQ,CAAE,MAAO,GAAGF,EAAE,eAAe,CAAC,eAAgB"}