import{d as T,p as M,ab as C,h as _,r as x,a as K,w as j,ad as q,n as $,F as Q,ae as V,c as y,X as P,j as w,k as N,D as z,e as W,u as H}from"./DwwldUEF.js";import{P as A,L as X,a as G,R as J,u as U,n as Y}from"./BtS8wA1z.js";import{g as I,_ as Z,w as ee,t as te,e as ae,d as re,c as ne}from"./BouOeHyj.js";import{u as L,c as O,d as oe}from"./VcnMPoS3.js";import{s as E}from"./Z8zkSHZ1.js";import{b as se}from"./CAa63J2U.js";import{s as ie}from"./CUvT7aun.js";import{u as ue,a as ce,i as F,b as le,c as de,h as fe}from"./Ds_kB4O7.js";import"./CWoQmekT.js";import{u as me}from"./I6oWuQE1.js";import{_ as pe}from"./YyHKzTTw.js";import{u as he}from"./DXCHDiK8.js";import{u as ve}from"./DyH7cufP.js";import{w as ge}from"./Ck0CgHQL.js";import"./tAHCZdDM.js";import"./BtUmmYon.js";import"./BVSSI1w3.js";import"./DzAq6MI-.js";import"./EYNRPfqu.js";import"./Bkc2CSET.js";import"./D8qJDlnG.js";import"./Cyc9srVp.js";import"./DEUi6v0t.js";import"./DNI0JtzU.js";import"./BCWuNC2L.js";import"./C8BbUAkk.js";import"./CU-snwr6.js";import"./jkP_3ymO.js";import"./BAdCBbtP.js";import"./TLA9Fm80.js";import"./ghAvikQd.js";import"./Dl1S6mqo.js";import"./aHnQ5-ra.js";import"../sb-preview/runtime.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new e.Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9eaf19ce-5374-4b5f-bcc8-5514e25f5f11",e._sentryDebugIdIdentifier="sentry-dbid-9eaf19ce-5374-4b5f-bcc8-5514e25f5f11")}catch{}})();const ye=T({props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(e){const n=e.renderKey,a=e.route,l={};for(const r in e.route)Object.defineProperty(l,r,{get:()=>n===e.renderKey?e.route[r]:a[r],enumerable:!0});return M(A,C(l)),()=>_(e.vnode,{ref:e.vnodeRef})}}),_e=T({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(e,{attrs:n,slots:a,expose:l}){const r=L(),o=x(),c=K(A,null);let f;l({pageRef:o});const i=K(X,null);let s;const g=r.deferHydration();if(r.isHydrating){const t=r.hooks.hookOnce("app:error",g);G().beforeEach(t)}return e.pageKey&&j(()=>e.pageKey,(t,h)=>{t!==h&&r.callHook("page:loading:start")}),()=>_(J,{name:e.name,route:e.route,...n},{default:t=>{const h=ke(c,t.route,t.Component),m=c&&c.matched.length===t.route.matched.length;if(!t.Component){if(s&&!m)return s;g();return}if(s&&i&&!i.isCurrent(t.route))return s;if(h&&c&&(!i||i!=null&&i.isCurrent(c)))return m?s:null;const p=I(t,e.pageKey);!r.isHydrating&&!Re(c,t.route,t.Component)&&f===p&&r.callHook("page:loading:end"),f=p;const d=!!(e.transition??t.route.meta.pageTransition??O),S=d&&be([e.transition,t.route.meta.pageTransition,O,{onAfterLeave:()=>{r.callHook("page:transition:finish",t.Component)}}].filter(Boolean)),b=e.keepalive??t.route.meta.keepalive??oe;return s=Z(V,d&&S,ee(b,_(q,{suspensible:!0,onPending:()=>r.callHook("page:start",t.Component),onResolve:()=>{$(()=>r.callHook("page:finish",t.Component).then(()=>r.callHook("page:loading:end")).finally(g))}},{default:()=>{const k=_(ye,{key:p||void 0,vnode:a.default?_(Q,void 0,a.default(t)):t.Component,route:t.route,renderKey:p||void 0,trackRootNodes:d,vnodeRef:o});return b&&(k.type.name=t.Component.type.name||t.Component.type.__name||"RouteProvider"),k}}))).default(),s}})}});function be(e){const n=e.map(a=>({...a,onAfterLeave:a.onAfterLeave?te(a.onAfterLeave):void 0}));return ae(...n)}function ke(e,n,a){if(!e)return!1;const l=n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)});return!l||l===-1?!1:n.matched.slice(0,l).some((r,o)=>{var c,f,i;return((c=r.components)==null?void 0:c.default)!==((i=(f=e.matched[o])==null?void 0:f.components)==null?void 0:i.default)})||a&&I({route:n,Component:a})!==I({route:e,Component:a})}function Re(e,n,a){return e?n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)})<n.matched.length-1:!1}const Se=["id"],we={key:1},xe=T({name:"SearchPage",__name:"search",async setup(e){let n,a;const l=L(),r=me(),o=ue(),c=ce(),f=U(),{searchTerm:i,searchType:s,apiSearchQueryParams:g}=E(c),{fetchState:t}=E(o),h=x(`${i.value} | Openverse`);j(i,()=>{h.value=`${i.value} | Openverse`}),ve(()=>({title:h.value}));const m=x(F(s.value)?{type:s.value,items:s.value===se?o.allMedia:o.resultItems[s.value]}:null),p=async(u={})=>{if(!F(s.value)||t.value.hasStarted&&d.value!==null&&!de(d.value))return;u.shouldPersistMedia||(m.value={type:s.value,items:[]});const R=await o.fetchMedia(u);return m.value={type:s.value,items:R},d.value===null||fe(d.value)?R:d.value},d=y(()=>t.value.fetchingError),S=y(()=>t.value.isFetching);ge(g,(u,v)=>{le(u,v)||Y(c.getSearchPath())},{debounce:800,maxWait:5e3});const b=y(()=>f.query),k=y(()=>f.path),B=y(()=>r.isOn("fetch_sensitive")),D=async()=>{await p({shouldPersistMedia:!0})};return[n,a]=P(async()=>he("search",async()=>{var v;if(l.isHydrating)return m.value;(v=document.getElementById("main-page"))==null||v.scroll(0,0);const u=await p();return!u||u&&"requestKind"in u?re(u??ne("No results found")):u},{server:!1,lazy:!0,watch:[B,b,k]})),await n,a(),(u,v)=>{const R=_e;return w(),N("div",{id:H(ie),tabindex:"-1",class:"browse-page flex w-full flex-col px-6 lg:px-10"},[d.value?(w(),z(pe,{key:0,"fetching-error":d.value,class:"w-full py-10"},null,8,["fetching-error"])):(w(),N("div",we,[W(R,{"page-key":(u._.provides[A]||u.$route).path,results:m.value,"is-fetching":S.value,"search-term":H(i),"handle-load-more":D,"data-testid":"search-results"},null,8,["page-key","results","is-fetching","search-term"])]))],8,Se)}}});xe.__docgenInfo={name:"SearchPage",exportName:"default",displayName:"search",description:"",tags:{},sourceFiles:["/home/runner/work/openverse/openverse/frontend/src/pages/search.vue"]};export{xe as default};
