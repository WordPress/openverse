{"version":3,"file":"EwlNBeUh.js","sources":["../../src/composables/use-layout.ts","../../.storybook/decorators/with-ui-store.js","../../.storybook/decorators/with-rtl.js","../../.storybook/decorators/with-theme.ts","../../.storybook/preview.ts"],"sourcesContent":["import { useWindowSize, watchDebounced } from \"@vueuse/core\"\n\nimport type { RealBreakpoint } from \"#shared/constants/screens\"\nimport { ALL_SCREEN_SIZES } from \"#shared/constants/screens\"\nimport { useUiStore } from \"~/stores/ui\"\n\nconst widthToBreakpoint = (width: number): RealBreakpoint => {\n  const bp = Object.entries(ALL_SCREEN_SIZES).find(\n    ([, bpWidth]) => width >= bpWidth\n  ) ?? [\"xs\", 0]\n  return bp[0] as RealBreakpoint\n}\n\n/**\n * This composable updates the UI store when the screen width changes or\n * when the SSR layout settings are different from the cookie settings.\n */\nexport function useLayout() {\n  const uiStore = useUiStore()\n\n  const { width } = useWindowSize()\n\n  const updateBreakpoint = () => {\n    uiStore.updateBreakpoint(widthToBreakpoint(width.value))\n  }\n\n  watchDebounced(\n    width,\n    (newWidth) => {\n      const newBp = widthToBreakpoint(newWidth)\n      uiStore.updateBreakpoint(newBp)\n    },\n    { debounce: 100 }\n  )\n\n  return {\n    updateBreakpoint,\n  }\n}\n","import { ref, onMounted, h } from \"vue\"\n\nimport { useLayout } from \"~/composables/use-layout\"\n\nexport const WithUiStore = (story) => {\n  return {\n    components: { story },\n    setup() {\n      const element = ref()\n      const { updateBreakpoint } = useLayout()\n      onMounted(() => {\n        updateBreakpoint()\n      })\n      return () => h(\"div\", { ref: element }, [h(story())])\n    },\n  }\n}\n","import { useI18n } from \"#imports\"\nimport { ref, watch, onMounted, reactive, h } from \"vue\"\n\nimport { useEffect } from \"@storybook/preview-api\"\n\nconst languageDirection = reactive({ value: \"ltr\" })\n\nexport const WithRTL = (story, context) => {\n  useEffect(() => {\n    languageDirection.value = context.globals.languageDirection\n  }, [context.globals.languageDirection])\n\n  return {\n    components: { story },\n    setup() {\n      const element = ref()\n      const i18n = useI18n({ useScope: \"global\" })\n\n      onMounted(() => {\n        watch(\n          languageDirection,\n          async (direction) => {\n            await i18n.setLocale(direction.value === \"rtl\" ? \"ar\" : \"en\")\n\n            if (element.value) {\n              element.value.ownerDocument.documentElement.setAttribute(\n                \"dir\",\n                direction?.value ?? \"ltr\"\n              )\n            }\n          },\n          { immediate: true }\n        )\n      })\n      return () => h(\"div\", { ref: element }, [h(story())])\n    },\n  }\n}\n","import { watch, onMounted, reactive, h } from \"vue\"\n\nimport { useEffect, useGlobals } from \"@storybook/preview-api\"\n\nimport { EffectiveColorMode } from \"#shared/types/ui\"\nimport { useUiStore } from \"~/stores/ui\"\nimport { useDarkMode } from \"~/composables/use-dark-mode\"\n\nimport VThemeSelect from \"~/components/VThemeSelect/VThemeSelect.vue\"\n\ntype ThemeCssClass = `${EffectiveColorMode}-mode`\nconst cssClassToTheme = (\n  cssClass: ThemeCssClass | undefined\n): EffectiveColorMode | undefined => cssClass?.split(\"-\")[0]\nconst isEffectiveColorMode = (\n  value: string | undefined\n): value is EffectiveColorMode => [\"light\", \"dark\"].includes(value)\n\nconst setElementTheme = (el: HTMLElement, cssClass: ThemeCssClass) => {\n  if (cssClass === \"dark-mode\") {\n    el.classList.add(\"dark-mode\")\n    el.classList.remove(\"light-mode\")\n    document.documentElement.style.setProperty(\n      \"--color-bg-curr-page\",\n      \"#0d0d0d\"\n    )\n  } else {\n    el.classList.add(\"light-mode\")\n    el.classList.remove(\"dark-mode\")\n\n    document.documentElement.style.setProperty(\n      \"--color-bg-curr-page\",\n      \"#ffffff\"\n    )\n  }\n}\n\nconst themeState = reactive<{ value: EffectiveColorMode }>({ value: \"light\" })\n\n/**\n * Decorator to add the Storybook theme switcher to the addon toolbar, and the Openverse\n * theme switcher to the bottom of the screen.\n * We cannot use the toolbar during the tests that open an iframe without the toolbars,\n * so we need to add the theme switcher to the bottom of the screen.\n * The state of both is kept in sync.\n */\nexport const WithTheme = (story) => {\n  const [globals, updateGlobals] = useGlobals()\n  themeState.value = globals.theme\n\n  useEffect(() => {\n    themeState.value = globals.theme\n  }, [globals.theme])\n\n  return {\n    components: { story },\n    setup() {\n      const { cssClass } = useDarkMode()\n      const uiStore = useUiStore()\n\n      watch(\n        themeState,\n        (newTheme) => {\n          if (isEffectiveColorMode(newTheme.value)) {\n            uiStore.setColorMode(newTheme.value)\n          }\n        },\n        { immediate: true }\n      )\n\n      watch(\n        cssClass,\n        (newCssClass) => {\n          setElementTheme(document.body, newCssClass)\n          const theme = cssClassToTheme(newCssClass)\n          if (theme) {\n            updateGlobals({ theme })\n          }\n        },\n        { immediate: true }\n      )\n\n      onMounted(() => {\n        document.body.classList.add(\"bg-default\")\n      })\n\n      // Set the height to the full height of the Storybook iframe minus the padding\n      // to position the theme switcher at the bottom of the screen.\n      return () =>\n        h(\"div\", { class: \"relative\", style: \"height: calc(100dvh - 32px);\" }, [\n          h(story()),\n          h(\n            \"div\",\n            { class: \"absolute bottom-0\", id: \"storybook-theme-switcher\" },\n            [h(VThemeSelect)]\n          ),\n        ])\n    },\n  }\n}\n","import { VIEWPORTS } from \"#shared/constants/screens\"\nimport { WithUiStore } from \"~~/.storybook/decorators/with-ui-store\"\nimport { WithRTL } from \"~~/.storybook/decorators/with-rtl\"\nimport { WithTheme } from \"~~/.storybook/decorators/with-theme\"\n\nimport type { Preview } from \"@storybook/vue3\"\n\nconst preview: Preview = {\n  decorators: [WithRTL, WithUiStore, WithTheme],\n  globalTypes: {\n    theme: {\n      name: \"Theme\",\n      description: \"Color theme\",\n      table: {\n        defaultValue: { summary: \"light\" },\n      },\n      toolbar: {\n        icon: \"circlehollow\",\n        items: [\n          { value: \"light\", title: \"Light\" },\n          { value: \"dark\", title: \"Dark\" },\n        ],\n      },\n    },\n    languageDirection: {\n      name: \"RTL\",\n      description: \"Simulate an RTL language.\",\n      table: {\n        defaultValue: { summary: \"ltr\" },\n      },\n      toolbar: {\n        icon: \"globe\",\n        items: [\n          { value: \"ltr\", title: \"LTR\" },\n          { value: \"rtl\", title: \"RTL\" },\n        ],\n      },\n    },\n  },\n  parameters: {\n    backgrounds: {\n      values: [\n        { name: \"light\", value: \"#ffffff\" },\n        { name: \"dark\", value: \"#0d0d0d\" },\n      ],\n    },\n    viewport: {\n      viewports: { ...VIEWPORTS },\n    },\n    actions: { argTypesRegex: \"^on[A-Z].*\" },\n    controls: {\n      matchers: {\n        color: /(background|color)$/i,\n        date: /Date$/,\n      },\n    },\n  },\n  initialGlobals: {\n    theme: \"light\",\n    languageDirection: \"ltr\",\n    backgrounds: { value: \"light\" },\n  },\n}\n\nexport default preview\n"],"names":["widthToBreakpoint","width","ALL_SCREEN_SIZES","bpWidth","useLayout","uiStore","useUiStore","useWindowSize","updateBreakpoint","watchDebounced","newWidth","newBp","WithUiStore","story","element","ref","onMounted","h","useEffect","languageDirection","reactive","WithRTL","context","i18n","useI18n","watch","direction","cssClassToTheme","cssClass","isEffectiveColorMode","value","setElementTheme","el","themeState","WithTheme","globals","updateGlobals","useGlobals","useDarkMode","newTheme","newCssClass","theme","VThemeSelect","preview","VIEWPORTS"],"mappings":"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"}