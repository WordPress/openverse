{"version":3,"file":"DqAbNI4A.js","sources":["../../src/utils/metadata.ts","../../src/components/VTooltip/VTooltip.vue","../../src/components/VMediaInfo/VSourceProviderTooltip.vue","../../src/components/VMediaInfo/VMetadata.vue"],"sourcesContent":["import { AUDIO, IMAGE } from \"#shared/constants/media\"\nimport { capitalCase } from \"#shared/utils/case\"\nimport type { AudioDetail, ImageDetail, Metadata } from \"#shared/types/media\"\nimport { useProviderStore } from \"~/stores/provider\"\n\nimport type { Composer } from \"vue-i18n\"\n\nconst getImageType = (imageType: string | undefined, t: Composer[\"t\"]) => {\n  if (imageType) {\n    if (imageType.split(\"/\").length > 1) {\n      return imageType.split(\"/\")[1]\n    }\n    return imageType\n  }\n  return t(\"mediaDetails.information.unknown\")\n}\n\nconst getAudioType = (audio: AudioDetail, t: Composer[\"t\"]) => {\n  if (!audio.alt_files) {\n    return audio.filetype ?? t(\"mediaDetails.information.unknown\")\n  }\n  const altFormats = audio.alt_files\n    .map((altFile) => altFile.filetype)\n    .filter((filetype) => filetype !== audio.filetype)\n  const uniqueFormats = Array.from(new Set(altFormats))\n  if (audio.filetype) {\n    uniqueFormats.unshift(audio.filetype)\n  }\n  return [...uniqueFormats].join(\", \")\n}\n\nexport const getMediaMetadata = (\n  media: AudioDetail | ImageDetail,\n  t: Composer[\"t\"],\n  imageInfo?: { width?: number; height?: number; type?: string }\n) => {\n  const metadata: Metadata[] = []\n  if (media.source && media.providerName !== media.sourceName) {\n    metadata.push({\n      name: \"provider\",\n      label: \"mediaDetails.providerLabel\",\n      value: media.providerName || media.provider,\n    })\n  }\n  const sourceUrl = useProviderStore().getSourceUrl(\n    media.source ?? media.provider,\n    media.frontendMediaType\n  )\n  const sourceName = media.sourceName ?? media.providerName ?? media.provider\n  metadata.push({\n    name: \"source\",\n    label: \"mediaDetails.sourceLabel\",\n    source: media.source ?? media.provider,\n    url: sourceUrl,\n    value: sourceName,\n  })\n\n  if (media.category) {\n    metadata.push({\n      label: \"mediaDetails.information.category\",\n      value: t(\n        `filters.${media.frontendMediaType}Categories.${media.category}`\n      ),\n    })\n  }\n\n  const mediaTypeString =\n    media.frontendMediaType === IMAGE\n      ? getImageType(imageInfo?.type, t)\n      : getAudioType(media, t)\n  metadata.push({\n    label: \"mediaDetails.information.type\",\n    value: mediaTypeString.toUpperCase(),\n  })\n\n  if (media.frontendMediaType === IMAGE) {\n    metadata.push({\n      label: \"imageDetails.information.dimensions\",\n      value: `${t(\"imageDetails.information.sizeInPixels\", {\n        width: imageInfo?.width,\n        height: imageInfo?.height,\n      })}`,\n    })\n  }\n  if (media.frontendMediaType === AUDIO) {\n    if (media.audio_set) {\n      metadata.unshift({\n        label: \"audioDetails.table.album\",\n        value: media.audio_set.title,\n        url: media.audio_set.foreign_landing_url,\n      })\n    }\n    if (media.genres && media.genres.length > 0) {\n      metadata.push({\n        label: \"audioDetails.table.genre\",\n        value: media.genres.map((genre) => capitalCase(genre)).join(\", \"),\n      })\n    }\n\n    if (media.sample_rate) {\n      metadata.push({\n        label: \"audioDetails.table.sampleRate\",\n        value: media.sample_rate.toString(),\n      })\n    }\n  }\n\n  return metadata\n}\n","<script setup lang=\"ts\">\nimport { ref, watch, toRefs, onBeforeUnmount } from \"vue\"\n\nimport type { ZIndex } from \"#shared/constants/z-indices\"\nimport { hasFocusWithin } from \"~/utils/reakit-utils/focus\"\nimport { useFloatingUi } from \"~/composables/use-floating-ui\"\n\nimport VIconButton from \"~/components/VIconButton/VIconButton.vue\"\n\nimport type { Placement, Strategy } from \"@floating-ui/dom\"\n\nconst props = withDefaults(\n  defineProps<{\n    /**\n     * The placement of the tooltip relative to the trigger. Should be one of the options\n     * for `placement` passed to floating-ui.\n     *\n     * @see https://floating-ui.com/docs/tutorial#placements\n     */\n    placement?: Placement\n    /**\n     * The positioning strategy of the tooltip. If your reference element is in a fixed container\n     * use the fixed strategy; otherwise use the default, absolute strategy.\n     *\n     * @see https://floating-ui.com/docs/computeposition#strategy\n     */\n    strategy?: Strategy\n    /**\n     * The id of the element labelling the popover content.\n     * The owning element must have `aria-describedby` set to this value.\n     */\n    describedBy: string\n    /**\n     * the z-index to apply to the tooltip content\n     */\n    zIndex?: ZIndex\n  }>(),\n  {\n    placement: \"bottom\",\n    strategy: \"absolute\",\n    zIndex: \"popover\",\n  }\n)\n\nconst visibleRef = ref(false)\nconst triggerContainerRef = ref<HTMLElement | null>(null)\n\nconst closeIfNeeded = () => {\n  if (triggerRef.value && !hasFocusWithin(triggerRef.value)) {\n    visibleRef.value = false\n  }\n}\n\nconst open = () => {\n  visibleRef.value = true\n}\n\nconst listeners = {\n  mouseover: open,\n  mouseout: closeIfNeeded,\n  focus: open,\n  blur: closeIfNeeded,\n}\n\nconst setTrigger = (triggerElement: HTMLElement) => {\n  triggerRef.value = triggerElement\n  for (const [event, listener] of Object.entries(listeners)) {\n    triggerElement.addEventListener(event, listener)\n  }\n}\n\nconst triggerRef = ref<HTMLElement | null>(null)\nwatch(triggerContainerRef, (container) => {\n  if (container) {\n    setTrigger(container.firstElementChild as HTMLElement)\n  }\n})\n\nonBeforeUnmount(() => {\n  if (triggerRef.value) {\n    for (const [event, listener] of Object.entries(listeners)) {\n      triggerRef.value.removeEventListener(event, listener)\n    }\n  }\n})\n\nconst tooltipRef = ref<HTMLElement | null>(null)\nconst propsRefs = toRefs(props)\n\nconst { style } = useFloatingUi({\n  floatingElRef: tooltipRef,\n  floatingPropsRefs: {\n    placement: propsRefs.placement,\n    strategy: propsRefs.strategy,\n    clippable: ref(false),\n    visible: visibleRef,\n    triggerElement: triggerRef,\n  },\n})\n\nconst handleEscape = () => {\n  if (visibleRef.value) {\n    visibleRef.value = false\n  }\n}\n</script>\n\n<template>\n  <div>\n    <!-- re: disabled static element interactions rule https://github.com/WordPress/openverse/issues/2906 -->\n    <!-- eslint-disable-next-line vuejs-accessibility/click-events-have-key-events, vuejs-accessibility/no-static-element-interactions -->\n    <div\n      ref=\"triggerContainerRef\"\n      class=\"flex w-min items-stretch whitespace-nowrap\"\n      @keydown.esc=\"handleEscape\"\n    >\n      <!--\n        @slot The trigger, should be a button 99.99% of the time. If you need custom event handling on the trigger button, ensure bubbling is not prevented or else the tooltip will not open\n          @binding {object} a11yProps\n          @binding {boolean} visible\n      -->\n      <slot name=\"trigger\" :open=\"open\">\n        <VIconButton\n          :label=\"describedBy\"\n          :aria-describedby=\"describedBy\"\n          variant=\"bordered-white\"\n          size=\"disabled\"\n          class=\"h-4 w-4 hover:!border-tx\"\n          :icon-props=\"{ name: 'info', size: 4 }\"\n          @click=\"open\"\n        />\n      </slot>\n    </div>\n    <div\n      v-show=\"visibleRef\"\n      :id=\"describedBy\"\n      ref=\"tooltipRef\"\n      role=\"tooltip\"\n      :class=\"`z-${zIndex} w-max-content absolute left-0 top-0`\"\n      :style=\"{ ...style }\"\n      :aria-hidden=\"!visibleRef\"\n    >\n      <slot />\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { useI18n } from \"#imports\"\nimport { computed } from \"vue\"\n\nimport type { Metadata } from \"#shared/types/media\"\n\nimport VTooltip from \"~/components/VTooltip/VTooltip.vue\"\n\nconst props = defineProps<{\n  datum: Metadata\n  describedBy: string\n}>()\n\nconst { t } = useI18n({ useScope: \"global\" })\nconst description = computed(() => {\n  if (!props.datum.name) {\n    return \"\"\n  }\n  return t(\n    props.datum.name === \"source\"\n      ? \"mediaDetails.sourceDescription\"\n      : \"mediaDetails.providerDescription\"\n  )\n})\n</script>\n\n<template>\n  <dt>\n    {{ $t(datum.label) }}\n    <VTooltip placement=\"top\" :described-by=\"describedBy\" class=\"ms-1\">\n      <template #default>\n        <p\n          class=\"caption-regular rounded-sm bg-tertiary px-2 py-1 text-over-dark\"\n        >\n          {{ description }}\n        </p>\n      </template>\n    </VTooltip>\n  </dt>\n</template>\n","<script setup lang=\"ts\">\nimport { useNuxtApp, useRoute } from \"#imports\"\nimport { computed } from \"vue\"\n\nimport { firstParam } from \"#shared/utils/query-utils\"\nimport type { Metadata } from \"#shared/types/media\"\nimport { useUiStore } from \"~/stores/ui\"\n\nimport VMetadataValue from \"~/components/VMediaInfo/VMetadataValue.vue\"\nimport VSourceProviderTooltip from \"~/components/VMediaInfo/VSourceProviderTooltip.vue\"\n\nconst props = defineProps<{\n  metadata: Metadata[]\n}>()\n\nconst route = useRoute()\nconst uiStore = useUiStore()\n\nconst isSm = computed(() => uiStore.isBreakpoint(\"sm\"))\nconst tooltipId = (datum: Metadata): \"source\" | \"provider\" | \"\" => {\n  if (datum.name && (datum.name === \"source\" || datum.name === \"provider\")) {\n    return datum.name\n  }\n  return \"\"\n}\n\nconst columnCount = computed(() => ({\n  \"--column-count\": props.metadata.length,\n}))\n\nconst { $sendCustomEvent } = useNuxtApp()\nconst sendVisitSourceLinkEvent = (source?: string) => {\n  const mediaId = firstParam(route?.params.id)\n  if (!source || !mediaId) {\n    return\n  }\n  $sendCustomEvent(\"VISIT_SOURCE_LINK\", {\n    id: mediaId,\n    source,\n  })\n}\n</script>\n\n<template>\n  <dl v-if=\"isSm\" class=\"metadata grid gap-8\" :style=\"columnCount\">\n    <div v-for=\"datum in metadata\" :key=\"datum.label\">\n      <VSourceProviderTooltip\n        v-if=\"tooltipId(datum)\"\n        :described-by=\"tooltipId(datum)\"\n        class=\"label-regular -ms-1 mb-1 flex flex-row items-center ps-1\"\n        :datum=\"datum\"\n      />\n      <dt v-else class=\"label-regular mb-1 flex flex-row ps-1\">\n        {{ $t(datum.label) }}\n      </dt>\n      <VMetadataValue\n        :datum=\"datum\"\n        :class=\"{ '-ms-1': Boolean(tooltipId(datum)) }\"\n        @click=\"sendVisitSourceLinkEvent(datum.source)\"\n      />\n    </div>\n  </dl>\n  <dl v-else class=\"grid grid-cols-[auto,1fr] gap-x-4 gap-y-2\">\n    <template v-for=\"datum in metadata\" :key=\"datum.label\">\n      <VSourceProviderTooltip\n        v-if=\"tooltipId(datum)\"\n        :described-by=\"tooltipId(datum)\"\n        class=\"label-regular -ms-1 flex flex-row items-center p-1 sm:ms-0 sm:py-0 sm:pe-0\"\n        :datum=\"datum\"\n      />\n      <dt\n        v-else\n        :id=\"datum.label\"\n        :key=\"datum.label\"\n        class=\"label-regular flex flex-row pt-1\"\n      >\n        {{ $t(datum.label) }}\n      </dt>\n      <VMetadataValue\n        :datum=\"datum\"\n        @click=\"sendVisitSourceLinkEvent(datum.source)\"\n      />\n    </template>\n  </dl>\n</template>\n\n<style scoped>\n@screen sm {\n  .metadata {\n    grid-template-columns: repeat(var(--column-count, 4), fit-content(10rem));\n  }\n}\n</style>\n"],"names":["getImageType","imageType","t","getAudioType","audio","altFormats","altFile","filetype","uniqueFormats","getMediaMetadata","media","imageInfo","metadata","sourceUrl","useProviderStore","sourceName","mediaTypeString","IMAGE","AUDIO","genre","capitalCase","props","__props","visibleRef","ref","triggerContainerRef","closeIfNeeded","triggerRef","hasFocusWithin","open","listeners","setTrigger","triggerElement","event","listener","watch","container","onBeforeUnmount","tooltipRef","propsRefs","toRefs","style","useFloatingUi","handleEscape","useI18n","description","computed","route","useRoute","uiStore","useUiStore","isSm","tooltipId","datum","columnCount","$sendCustomEvent","useNuxtApp","sendVisitSourceLinkEvent","source","mediaId","firstParam"],"mappings":"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"}