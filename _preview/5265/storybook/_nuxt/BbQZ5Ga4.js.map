{"version":3,"file":"BbQZ5Ga4.js","sources":["../../src/composables/use-sensitive-media.ts"],"sourcesContent":["import { computed, unref, Ref } from \"vue\"\n\nimport { useNuxtApp } from \"#app\"\n\nimport type { SensitiveMediaVisibility } from \"#shared/constants/content-safety\"\nimport type { Media } from \"#shared/types/media\"\nimport { useUiStore } from \"~/stores/ui\"\n\ntype SensitiveFields = Pick<Media, \"id\" | \"sensitivity\" | \"isSensitive\">\n\n/**\n * A helper composable for working with sensitive media.\n * Provides the current visibility of a sensitive media,\n * along with toggles for hiding/revealing the media.\n */\nexport function useSensitiveMedia(rawMedia: SensitiveFields | Ref | null) {\n  const uiStore = useUiStore()\n  const { $sendCustomEvent } = useNuxtApp()\n\n  /**\n   * The current state of a single sensitive media item.\n   * Respects defaults from the site's filters and is\n   * updated by user interactions.\n   */\n  const visibility = computed<SensitiveMediaVisibility>(() => {\n    const media = unref(rawMedia)\n    if (!media) {\n      return \"non-sensitive\"\n    } else if (media.isSensitive) {\n      if (uiStore.revealedSensitiveResults.includes(media.id)) {\n        return \"sensitive-shown\"\n      } else {\n        return uiStore.shouldBlurSensitive\n          ? \"sensitive-hidden\"\n          : \"sensitive-shown\"\n      }\n    } else {\n      return \"non-sensitive\"\n    }\n  })\n\n  function reveal() {\n    const media = unref(rawMedia)\n    if (media && !uiStore.revealedSensitiveResults.includes(media.id)) {\n      uiStore.revealedSensitiveResults.push(media.id)\n      $sendCustomEvent(\"UNBLUR_SENSITIVE_RESULT\", {\n        id: media.id,\n        sensitivities: media.sensitivity.join(\",\"),\n      })\n    }\n  }\n\n  function hide() {\n    const media = unref(rawMedia)\n    if (!media) {\n      return\n    }\n    const index = uiStore.revealedSensitiveResults.indexOf(media.id)\n    if (index > -1) {\n      uiStore.revealedSensitiveResults.splice(index, 1)\n    }\n    $sendCustomEvent(\"REBLUR_SENSITIVE_RESULT\", {\n      id: media.id,\n      sensitivities: media.sensitivity.join(\",\"),\n    })\n  }\n\n  const isHidden = computed(() => {\n    const media = unref(rawMedia)\n    return (\n      media &&\n      uiStore.shouldBlurSensitive &&\n      media.isSensitive &&\n      visibility.value === \"sensitive-hidden\"\n    )\n  })\n\n  const canBeHidden = computed(() => {\n    const media = unref(rawMedia)\n    return (\n      media &&\n      uiStore.shouldBlurSensitive &&\n      media.isSensitive &&\n      visibility.value === \"sensitive-shown\"\n    )\n  })\n\n  return { visibility, reveal, hide, isHidden, canBeHidden }\n}\n"],"names":["useSensitiveMedia","rawMedia","uiStore","useUiStore","$sendCustomEvent","useNuxtApp","visibility","computed","media","unref","reveal","hide","index","isHidden","canBeHidden"],"mappings":"kdAeO,SAASA,EAAkBC,EAAwC,CACxE,MAAMC,EAAUC,EAAW,EACrB,CAAE,iBAAAC,CAAiB,EAAIC,EAAW,EAOlCC,EAAaC,EAAmC,IAAM,CACpD,MAAAC,EAAQC,EAAMR,CAAQ,EAC5B,OAAKO,GAEMA,EAAM,YACXN,EAAQ,yBAAyB,SAASM,EAAM,EAAE,EAC7C,kBAEAN,EAAQ,oBACX,mBACA,kBAPC,eAWT,CACD,EAED,SAASQ,GAAS,CACV,MAAAF,EAAQC,EAAMR,CAAQ,EACxBO,GAAS,CAACN,EAAQ,yBAAyB,SAASM,EAAM,EAAE,IACtDN,EAAA,yBAAyB,KAAKM,EAAM,EAAE,EAC9CJ,EAAiB,0BAA2B,CAC1C,GAAII,EAAM,GACV,cAAeA,EAAM,YAAY,KAAK,GAAG,CAAA,CAC1C,EACH,CAGF,SAASG,GAAO,CACR,MAAAH,EAAQC,EAAMR,CAAQ,EAC5B,GAAI,CAACO,EACH,OAEF,MAAMI,EAAQV,EAAQ,yBAAyB,QAAQM,EAAM,EAAE,EAC3DI,EAAQ,IACFV,EAAA,yBAAyB,OAAOU,EAAO,CAAC,EAElDR,EAAiB,0BAA2B,CAC1C,GAAII,EAAM,GACV,cAAeA,EAAM,YAAY,KAAK,GAAG,CAAA,CAC1C,CAAA,CAGG,MAAAK,EAAWN,EAAS,IAAM,CACxB,MAAAC,EAAQC,EAAMR,CAAQ,EAC5B,OACEO,GACAN,EAAQ,qBACRM,EAAM,aACNF,EAAW,QAAU,kBAAA,CAExB,EAEKQ,EAAcP,EAAS,IAAM,CAC3B,MAAAC,EAAQC,EAAMR,CAAQ,EAC5B,OACEO,GACAN,EAAQ,qBACRM,EAAM,aACNF,EAAW,QAAU,iBAAA,CAExB,EAED,MAAO,CAAE,WAAAA,EAAY,OAAAI,EAAQ,KAAAC,EAAM,SAAAE,EAAU,YAAAC,CAAY,CAC3D"}