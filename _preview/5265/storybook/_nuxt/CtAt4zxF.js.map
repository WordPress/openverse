{"version":3,"file":"CtAt4zxF.js","sources":["../../src/components/VAudioThumbnail/VAudioThumbnail.vue"],"sourcesContent":["<script setup lang=\"ts\">\n/**\n * Displays the cover art for the audio in a square aspect ratio.\n */\nimport { useI18n } from \"#imports\"\nimport { toRefs, ref, onMounted } from \"vue\"\n\nimport { rand, hash } from \"#shared/utils/prng\"\nimport { lerp, dist, bezier, Point } from \"#shared/utils/math\"\nimport type { AudioDetail } from \"#shared/types/media\"\nimport { useSensitiveMedia } from \"~/composables/use-sensitive-media\"\n\nconst props = defineProps<{\n  /**\n   * The details of the audio whose artwork is to be shown.\n   */\n  audio: Pick<AudioDetail, \"thumbnail\" | \"title\" | \"creator\">\n}>()\n\nconst { audio } = toRefs(props)\nconst { isHidden: shouldBlur } = useSensitiveMedia(audio)\n\nconst { t } = useI18n({ useScope: \"global\" })\nconst helpText = shouldBlur.value\n  ? t(\"sensitiveContent.title.audio\")\n  : t(\"audioThumbnail.alt\", {\n      title: props.audio.title,\n      creator: props.audio.creator,\n    })\n\n/* Switching */\n\nconst imgEl = ref<HTMLImageElement | null>(null)\nconst isOk = ref(false)\nconst handleLoad = () => {\n  isOk.value = true\n}\nonMounted(() => {\n  isOk.value = Boolean(imgEl.value?.complete && imgEl.value?.naturalWidth)\n})\n\n/* Artwork */\n\nconst dotCount = 10\nconst canvasSize = 768\nconst minRadius = 2\nconst maxRadius = 27\n\nconst random = rand(hash(props.audio.title ?? \"\"))\nconst ctrlPts = Array.from(\n  { length: 4 },\n  (_, idx) => [random() * canvasSize, (idx / 3) * canvasSize] as Point\n)\n\nconst pointCount = dotCount + 1\nconst bezierPoints = bezier(ctrlPts, pointCount)\n\nconst offset = (i: number) => {\n  return i * (canvasSize / (dotCount + 1))\n}\nconst radius = (i: number, j: number) => {\n  const bezierPoint = bezierPoints[i]\n  const distance = dist([0, bezierPoint], [0, offset(j)])\n  const maxFeasibleDistance = canvasSize * ((dotCount - 1) / (dotCount + 1))\n  return lerp(maxRadius, minRadius, distance / maxFeasibleDistance)\n}\n</script>\n\n<template>\n  <!-- Should be wrapped by a fixed-width parent -->\n  <div class=\"relative h-0 w-full overflow-hidden pt-full\" :title=\"helpText\">\n    <!-- Programmatic thumbnail -->\n    <svg\n      v-if=\"!isOk\"\n      class=\"absolute inset-0 bg-complementary\"\n      :viewBox=\"`0 0 ${canvasSize} ${canvasSize}`\"\n    >\n      <template v-for=\"i in dotCount\">\n        <circle\n          v-for=\"j in dotCount\"\n          v-show=\"!shouldBlur\"\n          :key=\"`${i}-${j}`\"\n          class=\"fill-gray-12\"\n          :cx=\"offset(j)\"\n          :cy=\"offset(i)\"\n          :r=\"radius(i, j)\"\n        />\n      </template>\n    </svg>\n\n    <!-- The element that blurs the programmatic thumbnail -->\n    <div\n      v-show=\"shouldBlur && !audio.thumbnail\"\n      class=\"absolute bg-complementary\"\n    />\n\n    <div v-show=\"audio.thumbnail && isOk\" class=\"thumbnail absolute inset-0\">\n      <img\n        ref=\"imgEl\"\n        class=\"h-full w-full overflow-clip object-cover object-center duration-200 motion-safe:transition-[filter,transform]\"\n        :class=\"{ 'scale-150 blur-image': shouldBlur }\"\n        :src=\"audio.thumbnail\"\n        :alt=\"helpText\"\n        @load=\"handleLoad\"\n      />\n    </div>\n\n    <VIcon\n      v-show=\"shouldBlur\"\n      name=\"eye-closed\"\n      class=\"absolute left-[calc(50%-0.75rem)] top-[calc(50%-0.75rem)]\"\n    />\n  </div>\n</template>\n"],"names":["dotCount","canvasSize","minRadius","maxRadius","props","__props","audio","toRefs","shouldBlur","useSensitiveMedia","t","useI18n","helpText","imgEl","ref","isOk","handleLoad","onMounted","_a","_b","random","rand","hash","ctrlPts","_","idx","pointCount","bezierPoints","bezier","offset","i","radius","j","bezierPoint","distance","dist","maxFeasibleDistance","lerp"],"mappings":"2wBA2CMA,EAAW,GACXC,EAAa,IACbC,EAAY,EACZC,EAAY,2DAlClB,MAAMC,EAAQC,EAOR,CAAE,MAAAC,CAAA,EAAUC,EAAOH,CAAK,EACxB,CAAE,SAAUI,GAAeC,EAAkBH,CAAK,EAElD,CAAE,EAAAI,CAAE,EAAIC,EAAQ,CAAE,SAAU,SAAU,EACtCC,EAAWJ,EAAW,MACxBE,EAAE,8BAA8B,EAChCA,EAAE,qBAAsB,CACtB,MAAON,EAAM,MAAM,MACnB,QAASA,EAAM,MAAM,OAAA,CACtB,EAICS,EAAQC,EAA6B,IAAI,EACzCC,EAAOD,EAAI,EAAK,EAChBE,EAAa,IAAM,CACvBD,EAAK,MAAQ,EACf,EACAE,EAAU,IAAM,SACdF,EAAK,MAAQ,IAAQG,EAAAL,EAAM,QAAN,MAAAK,EAAa,YAAYC,EAAAN,EAAM,QAAN,MAAAM,EAAa,cAAY,CACxE,EASD,MAAMC,EAASC,EAAKC,EAAKlB,EAAM,MAAM,OAAS,EAAE,CAAC,EAC3CmB,EAAU,MAAM,KACpB,CAAE,OAAQ,CAAE,EACZ,CAACC,EAAGC,IAAQ,CAACL,EAAW,EAAAnB,EAAawB,EAAM,EAAKxB,CAAU,CAC5D,EAEMyB,EAAa1B,EAAW,EACxB2B,EAAeC,EAAOL,EAASG,CAAU,EAEzCG,EAAUC,GACPA,GAAK7B,GAAcD,EAAW,IAEjC+B,EAAS,CAACD,EAAWE,IAAc,CACjC,MAAAC,EAAcN,EAAaG,CAAC,EAC5BI,EAAWC,EAAK,CAAC,EAAGF,CAAW,EAAG,CAAC,EAAGJ,EAAOG,CAAC,CAAC,CAAC,EAChDI,EAAsBnC,IAAeD,EAAW,IAAMA,EAAW,IACvE,OAAOqC,EAAKlC,EAAWD,EAAWgC,EAAWE,CAAmB,CAClE"}