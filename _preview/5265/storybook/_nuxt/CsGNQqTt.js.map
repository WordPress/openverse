{"version":3,"file":"CsGNQqTt.js","sources":["../../src/components/VSearchResultsTitle.vue","../../src/components/VExternalSearch/VExternalSearchForm.vue","../../src/components/VSearchResultsGrid/VSearchResults.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useI18n } from \"#imports\"\nimport { computed } from \"vue\"\n\nimport type {\n  SupportedMediaType,\n  SupportedSearchType,\n} from \"#shared/constants/media\"\nimport { useGetLocaleFormattedNumber } from \"~/composables/use-get-locale-formatted-number\"\nimport { getCountKey } from \"~/composables/use-i18n-utilities\"\n\nconst props = withDefaults(\n  defineProps<{\n    searchTerm: string\n    searchType: SupportedSearchType\n    resultCounts: [SupportedMediaType, number][]\n    size?: \"default\" | \"large\"\n  }>(),\n  {\n    size: \"default\",\n  }\n)\n\nconst getLocaleFormattedNumber = useGetLocaleFormattedNumber()\nconst { t } = useI18n()\nconst mediaLocaleCounts = computed(() =>\n  props.resultCounts.reduce(\n    (acc, [mediaType, count]) => {\n      return {\n        ...acc,\n        [mediaType]: {\n          count,\n          countKey: getCountKey(count),\n          localeCount: getLocaleFormattedNumber(count),\n        },\n      }\n    },\n    {} as Record<\n      SupportedMediaType,\n      { count: number; countKey: string; localeCount: string }\n    >\n  )\n)\n\nconst _getAllMediaAriaHeading = () => {\n  const imageLocaleCounts = mediaLocaleCounts.value.image\n  const imageResults = t(\n    `browsePage.aria.allResultsHeadingCount.image.${imageLocaleCounts.countKey}`,\n    {\n      localeCount: imageLocaleCounts.localeCount,\n    }\n  )\n\n  const audioLocaleCounts = mediaLocaleCounts.value.audio\n  const audioResults = t(\n    `browsePage.aria.allResultsHeadingCount.audio.${audioLocaleCounts.countKey}`,\n    {\n      localeCount: audioLocaleCounts.localeCount,\n    }\n  )\n\n  return t(\"browsePage.aria.results.all\", {\n    query: props.searchTerm,\n    imageResults,\n    audioResults,\n  })\n}\n\nconst ariaHeading = computed((): string => {\n  switch (props.searchType) {\n    case \"image\": {\n      const { count, countKey, localeCount } = mediaLocaleCounts.value.image\n      return t(`browsePage.aria.results.image.${countKey}`, {\n        count,\n        localeCount,\n        query: props.searchTerm,\n      })\n    }\n    case \"audio\": {\n      const { count, countKey, localeCount } = mediaLocaleCounts.value.audio\n      return t(`browsePage.aria.results.audio.${countKey}`, {\n        count,\n        localeCount,\n        query: props.searchTerm,\n      })\n    }\n    default:\n    case \"all\": {\n      return _getAllMediaAriaHeading()\n    }\n  }\n})\n</script>\n\n<template>\n  <h1\n    class=\"sr-only break-words md:not-sr-only\"\n    :class=\"[\n      size === 'large'\n        ? 'heading-2 lg:heading-1 !leading-none lg:!leading-none'\n        : 'heading-2 !leading-none',\n    ]\"\n  >\n    <span aria-hidden=\"true\">{{ searchTerm }}</span\n    ><span class=\"sr-only\">{{ ariaHeading }}</span>\n  </h1>\n</template>\n\n<style scoped>\n/* Title case the user's search query */\nh1:first-letter {\n  text-transform: uppercase;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { useNuxtApp } from \"#imports\"\nimport { computed, ref } from \"vue\"\n\nimport { storeToRefs } from \"pinia\"\n\nimport { EXTERNAL_SEARCH_DIALOG } from \"#shared/constants/dialogs\"\nimport { useUiStore } from \"~/stores/ui\"\nimport { useSearchStore } from \"~/stores/search\"\nimport { useMediaStore } from \"~/stores/media\"\nimport { useExternalSources } from \"~/composables/use-external-sources\"\n\nimport VExternalSourceList from \"~/components/VExternalSearch/VExternalSourceList.vue\"\nimport VButton from \"~/components/VButton.vue\"\nimport VIcon from \"~/components/VIcon/VIcon.vue\"\nimport VModal from \"~/components/VModal/VModal.vue\"\n\nwithDefaults(\n  defineProps<{\n    searchTerm: string\n    isSupported?: boolean\n    hasNoResults?: boolean\n  }>(),\n  {\n    isSupported: false,\n    hasNoResults: true,\n  }\n)\n\nconst sectionRef = ref<HTMLElement | null>(null)\nconst searchStore = useSearchStore()\nconst uiStore = useUiStore()\n\nconst { $sendCustomEvent } = useNuxtApp()\n\nconst mediaStore = useMediaStore()\nconst { currentPage } = storeToRefs(mediaStore)\n\nconst handleModalOpen = () => {\n  $sendCustomEvent(\"VIEW_EXTERNAL_SOURCES\", {\n    searchType: searchStore.searchType,\n    query: searchStore.searchTerm,\n    resultPage: currentPage.value || 1,\n  })\n}\n\nconst { externalSourcesType } = useExternalSources()\n\nconst isMd = computed(() => uiStore.isBreakpoint(\"md\"))\n</script>\n\n<template>\n  <section\n    :key=\"externalSourcesType\"\n    ref=\"sectionRef\"\n    class=\"external-sources flex flex-row place-items-center justify-center pb-6 pt-4 lg:pb-10\"\n    data-testid=\"external-sources-form\"\n  >\n    <VModal\n      :id=\"EXTERNAL_SEARCH_DIALOG\"\n      variant=\"centered\"\n      :hide-on-click-outside=\"true\"\n      labelled-by=\"external-sources-button\"\n      class=\"w-full\"\n      @open=\"handleModalOpen\"\n    >\n      <template #trigger=\"{ a11yProps }\">\n        <VButton\n          id=\"external-sources-button\"\n          ref=\"triggerRef\"\n          :pressed=\"a11yProps['aria-expanded']\"\n          aria-haspopup=\"dialog\"\n          aria-controls=\"external-sources-modal\"\n          variant=\"bordered-gray\"\n          size=\"disabled\"\n          class=\"label-bold lg:description-bold h-16 w-full gap-x-2 lg:h-18\"\n        >\n          <i18n-t\n            v-if=\"isMd\"\n            scope=\"global\"\n            keypath=\"externalSources.form.supportedTitle\"\n            tag=\"p\"\n          />\n          <i18n-t\n            v-else\n            scope=\"global\"\n            keypath=\"externalSources.form.supportedTitleSm\"\n            tag=\"p\"\n          />\n          <VIcon\n            :class=\"{\n              'text-over-dark': a11yProps['aria-expanded'],\n            }\"\n            name=\"caret-down\"\n          />\n        </VButton>\n      </template>\n      <template #title>\n        <h2 class=\"heading-6\" tabindex=\"-1\">\n          {{ $t(\"externalSources.title\") }}\n        </h2>\n      </template>\n      <VExternalSourceList class=\"flex flex-col\" :search-term=\"searchTerm\" />\n    </VModal>\n  </section>\n</template>\n","<script setup lang=\"ts\">\nimport { useI18n } from \"#imports\"\nimport { computed } from \"vue\"\n\nimport type { SupportedMediaType } from \"#shared/constants/media\"\nimport type { Results } from \"#shared/types/result\"\nimport { useMediaStore } from \"~/stores/media\"\nimport { useSearchStore } from \"~/stores/search\"\n\nimport VSearchResultsTitle from \"~/components/VSearchResultsTitle.vue\"\nimport VMediaCollection from \"~/components/VSearchResultsGrid/VMediaCollection.vue\"\nimport VLoadMore from \"~/components/VLoadMore.vue\"\nimport VExternalSearchForm from \"~/components/VExternalSearch/VExternalSearchForm.vue\"\nimport VContentLink from \"~/components/VContentLink/VContentLink.vue\"\n\nconst props = defineProps<{\n  searchTerm: string\n  results: Results\n  isFetching: boolean\n}>()\n\ndefineEmits<{ \"load-more\": [] }>()\n\nconst { t } = useI18n()\nconst mediaStore = useMediaStore()\nconst searchStore = useSearchStore()\n\nconst collectionLabel = computed(() => {\n  return t(`browsePage.aria.resultsLabel.${props.results.type}`, {\n    query: props.searchTerm,\n  })\n})\nconst contentLinkPath = (mediaType: SupportedMediaType) =>\n  searchStore.getSearchPath({ type: mediaType })\n\nconst resultCounts = computed(() => mediaStore.resultCountsPerMediaType)\n</script>\n\n<template>\n  <VMediaCollection\n    :collection-label=\"collectionLabel\"\n    :results=\"results\"\n    :is-fetching=\"isFetching\"\n    :search-term=\"searchTerm\"\n    kind=\"search\"\n  >\n    <template #header>\n      <header v-if=\"searchTerm\" class=\"my-0 md:mb-8 md:mt-4\">\n        <VSearchResultsTitle\n          :search-term=\"searchTerm\"\n          :size=\"results.type === 'all' ? 'large' : 'default'\"\n          :search-type=\"results.type\"\n          :result-counts=\"resultCounts\"\n          >{{ searchTerm }}</VSearchResultsTitle\n        >\n      </header>\n\n      <div\n        v-if=\"results.type === 'all'\"\n        class=\"mb-4 mt-2 grid grid-cols-2 gap-4 md:mt-0\"\n      >\n        <VContentLink\n          v-for=\"[mediaType, count] in resultCounts\"\n          :key=\"mediaType\"\n          :media-type=\"mediaType\"\n          :search-term=\"searchTerm\"\n          :results-count=\"count\"\n          :to=\"contentLinkPath(mediaType)\"\n        />\n      </div>\n    </template>\n    <template #footer>\n      <footer class=\"mb-6 mt-4 lg:mb-10\">\n        <VLoadMore\n          :search-type=\"results.type\"\n          kind=\"search\"\n          :search-term=\"searchTerm\"\n          :is-fetching=\"isFetching\"\n          class=\"mb-4\"\n          @load-more=\"$emit('load-more')\"\n        />\n        <VExternalSearchForm\n          v-if=\"results.type !== 'all'\"\n          :search-term=\"searchTerm\"\n          :is-supported=\"true\"\n          :has-no-results=\"false\"\n        />\n      </footer>\n    </template>\n  </VMediaCollection>\n</template>\n"],"names":["props","__props","getLocaleFormattedNumber","useGetLocaleFormattedNumber","t","useI18n","mediaLocaleCounts","computed","acc","mediaType","count","getCountKey","_getAllMediaAriaHeading","imageLocaleCounts","imageResults","audioLocaleCounts","audioResults","ariaHeading","countKey","localeCount","sectionRef","ref","searchStore","useSearchStore","uiStore","useUiStore","$sendCustomEvent","useNuxtApp","mediaStore","useMediaStore","currentPage","storeToRefs","handleModalOpen","externalSourcesType","useExternalSources","isMd","collectionLabel","contentLinkPath","resultCounts"],"mappings":"+rCAWA,MAAMA,EAAQC,EAYRC,EAA2BC,EAA4B,EACvD,CAAE,EAAAC,CAAE,EAAIC,EAAQ,EAChBC,EAAoBC,EAAS,IACjCP,EAAM,aAAa,OACjB,CAACQ,EAAK,CAACC,EAAWC,CAAK,KACd,CACL,GAAGF,EACH,CAACC,CAAS,EAAG,CACX,MAAAC,EACA,SAAUC,EAAYD,CAAK,EAC3B,YAAaR,EAAyBQ,CAAK,CAAA,CAE/C,GAEF,CAAA,CAAC,CAKL,EAEME,EAA0B,IAAM,CAC9B,MAAAC,EAAoBP,EAAkB,MAAM,MAC5CQ,EAAeV,EACnB,gDAAgDS,EAAkB,QAAQ,GAC1E,CACE,YAAaA,EAAkB,WAAA,CAEnC,EAEME,EAAoBT,EAAkB,MAAM,MAC5CU,EAAeZ,EACnB,gDAAgDW,EAAkB,QAAQ,GAC1E,CACE,YAAaA,EAAkB,WAAA,CAEnC,EAEA,OAAOX,EAAE,8BAA+B,CACtC,MAAOJ,EAAM,WACb,aAAAc,EACA,aAAAE,CAAA,CACD,CACH,EAEMC,EAAcV,EAAS,IAAc,CACzC,OAAQP,EAAM,WAAY,CACxB,IAAK,QAAS,CACZ,KAAM,CAAE,MAAAU,EAAO,SAAAQ,EAAU,YAAAC,CAAY,EAAIb,EAAkB,MAAM,MAC1D,OAAAF,EAAE,iCAAiCc,CAAQ,GAAI,CACpD,MAAAR,EACA,YAAAS,EACA,MAAOnB,EAAM,UAAA,CACd,CAAA,CAEH,IAAK,QAAS,CACZ,KAAM,CAAE,MAAAU,EAAO,SAAAQ,EAAU,YAAAC,CAAY,EAAIb,EAAkB,MAAM,MAC1D,OAAAF,EAAE,iCAAiCc,CAAQ,GAAI,CACpD,MAAAR,EACA,YAAAS,EACA,MAAOnB,EAAM,UAAA,CACd,CAAA,CAEH,QACA,IAAK,MACH,OAAOY,EAAwB,CACjC,CACF,CACD,qiCC9DK,MAAAQ,EAAaC,EAAwB,IAAI,EACzCC,EAAcC,EAAe,EAC7BC,EAAUC,EAAW,EAErB,CAAE,iBAAAC,CAAiB,EAAIC,EAAW,EAElCC,EAAaC,EAAc,EAC3B,CAAE,YAAAC,CAAA,EAAgBC,EAAYH,CAAU,EAExCI,EAAkB,IAAM,CAC5BN,EAAiB,wBAAyB,CACxC,WAAYJ,EAAY,WACxB,MAAOA,EAAY,WACnB,WAAYQ,EAAY,OAAS,CAAA,CAClC,CACH,EAEM,CAAE,oBAAAG,CAAoB,EAAIC,EAAmB,EAE7CC,EAAO5B,EAAS,IAAMiB,EAAQ,aAAa,IAAI,CAAC,mzDCjCtD,MAAMxB,EAAQC,EAQR,CAAE,EAAAG,CAAE,EAAIC,EAAQ,EAChBuB,EAAaC,EAAc,EAC3BP,EAAcC,EAAe,EAE7Ba,EAAkB7B,EAAS,IACxBH,EAAE,gCAAgCJ,EAAM,QAAQ,IAAI,GAAI,CAC7D,MAAOA,EAAM,UAAA,CACd,CACF,EACKqC,EAAmB5B,GACvBa,EAAY,cAAc,CAAE,KAAMb,EAAW,EAEzC6B,EAAe/B,EAAS,IAAMqB,EAAW,wBAAwB"}