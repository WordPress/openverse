import{c as s,r as D,d as we,v as ae,k as d,u as k,I as M,M as L,F as K,H as se,a7 as G,L as re,Q as $,N as _e,af as xe,j as f}from"./DwwldUEF.js";import"./CWoQmekT.js";import{r as Te,h as Se}from"./Dl1S6mqo.js";import{k as S}from"./CzJ3cZ9I.js";import{u as Fe}from"./D93TPuWH.js";import{u as Ae}from"./6EtbFbqO.js";import{_ as Me}from"./DhTbjJlp.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new a.Error().stack;u&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[u]="28ab41ea-cc06-4d72-ab5c-a200a71abb28",a._sentryDebugIdIdentifier="sentry-dbid-28ab41ea-cc06-4d72-ab5c-a200a71abb28")}catch{}})();const Pe=({duration:a,currentTime:u,isSeekable:t,isReady:n,onSeek:i,onTogglePlayback:o})=>{const{t:l}=Fe({useScope:"global"}),m=s(()=>({"aria-role":"slider","aria-valuemax":a.value,"aria-valuenow":u.value,"aria-valuetext":l("waveform.currentTime",{time:u.value}),"aria-orientation":"horizontal","aria-valuemin":"0"})),r=1,b=15,_=s(()=>n.value?b/a.value:0),v=s(()=>n.value?r/a.value:0),p=s(()=>n.value?u.value/a.value:0),h=D(!1),x=c=>{const{key:C,shiftKey:H,metaKey:E}=c;if(E)i(C.includes("Left")?0:1);else{const T=C.includes("Left")?-1:1,O=(H?_.value:v.value)*T;i(p.value+O)}},y=[S.ArrowLeft,S.ArrowRight],P=[...y,S.Home,S.End],w=[...P,S.Spacebar],B=c=>t.value?w.includes(c.key):c.key===S.Spacebar;return{attributes:m,listeners:{keydown:c=>{if(B(c)){if(c.preventDefault(),h.value=P.includes(c.key),y.includes(c.key))return x(c);if(c.key===S.Home)return i(0);if(c.key===S.End)return i(1);if(c.key===S.Spacebar)return o()}},blur:()=>{h.value=!1}},meta:{modSeekDeltaFrac:_,seekDeltaFrac:v,currentFrac:p},willBeHandled:B,isSeeking:h}},Be=(a,u)=>{const t=(o,l,m)=>o+(l-o)*m,n=[],i=(a.length-1)/(u-1);n[0]=a[0];for(let o=1;o<u-1;o++){const l=o*i,m=Math.floor(l),r=Math.ceil(l),b=l-m;n[o]=t(a[m],a[r],b)}return n[u-1]=a[a.length-1],n},Ie=(a,u)=>{const t=a.length,n=[];let i=0;const o=(t-2)/(u-2);let l=0,m,r,b,_;n[i++]=a[l];for(let v=0;v<u-2;v++){let p=0,h=0,x=Math.floor((v+1)*o)+1,y=Math.floor((v+2)*o)+1;y=y<t?y:t;const P=y-x;for(;x<y;x++)p+=x,h+=a[x];p/=P,h/=P;let w=Math.floor(v*o)+1;const B=Math.floor((v+1)*o)+1,I=l,W=a[l];for(r=b=-1,m=0,_=0;w<B;w++)b=Math.abs((I-p)*(a[w]-W)-(I-w)*(h-W))*.5,b>r&&(r=b,m=a[w],_=w);n[i++]=m,l=_}return n[i++]=a[t-1],n},Q=(a,u=!1)=>{const t=u?a/1e3:a,n=~~(t/3600);let i=(~~(t%3600/60)).toString();const o=(~~t%60).toString().padStart(2,"0"),l=[];return n>0&&(l.push(n),i=i.padStart(2,"0")),l.push(i,o),l.join(":")},De=["tabIndex","aria-disabled","aria-label"],We=["viewBox"],Ve=["width","height"],Ee=["width","height"],qe=["viewBox"],Le=["width"],Ce=["viewBox"],Ne=["x","y","height"],Re={key:1,class:"duration timestamp bg-background-var right-0"},ze={key:3,class:"loading absolute inset-0 flex items-center justify-center text-xs font-bold"},Ke=1,j=2,U=2,$e=2,ne=we({__name:"VWaveform",props:{peaks:{},message:{},currentTime:{default:0},duration:{default:0},usableFrac:{default:1},features:{default:()=>["timestamps","seek"]},featureNotices:{default:()=>({})},audioId:{},isTabbable:{type:Boolean,default:!0},isParentSeeking:{type:Boolean,default:!1}},emits:["seeked","toggle-playback","focus","blur"],setup(a,{emit:u}){const t=a,n=u,i=e=>m.value?e.clientX-m.value.getBoundingClientRect().x:e.clientX,o=e=>i(e)/r.value.width,l=e=>Math.floor((e-U)/(j+U)),m=D(null),{dimens:r}=Ae(m),b=s(()=>t.features.includes("duration")),_=s(()=>t.features.includes("timestamps")),v=s(()=>t.features.includes("seek")),p=s(()=>!t.message),h=s(()=>v.value&&p.value),x=s(()=>!t.isTabbable&&t.isParentSeeking||le.value),y=s(()=>l(r.value.width)),P=e=>{const g=Te(Se(e));return Array.from({length:100},()=>g())},w=s(()=>{var e;return(e=t.peaks)!=null&&e.length?t.peaks:P(t.audioId)}),B=s(()=>{let e=w.value;const g=e.length,F=y.value;return g<F?e=Be(e,F):g>F&&(e=Ie(e,F)),e.map(A=>Math.max(A,0)*r.value.height)}),I=s(()=>[0,0,r.value.width,r.value.height].join(" ")),W=e=>e*j+e*U,J=e=>r.value.height-B.value[e],V=s(()=>{const e=q.value?T.value??0:Z.value;return r.value.width*e}),c=D(),C=s(()=>q.value?Y.value:t.currentTime),H=s(()=>{if(!c.value)return!1;const e=V.value,g=c.value.offsetWidth;return e<g+2}),E=s(()=>Number.isFinite(t.duration)&&t.duration<Ke),T=D(null),N=s(()=>{const e=T.value??Z.value;return r.value.width*e}),O=s(()=>l(N.value)),X=D(null),Y=s(()=>T.value?T.value*t.duration:t.duration),oe=s(()=>{if(!X.value)return!1;const e=N.value,g=X.value.offsetWidth;return e<g+2}),{isSeeking:le,...R}=Pe({duration:ae(t,"duration"),currentTime:ae(t,"currentTime"),isSeekable:v,isReady:p,onSeek:e=>{te(),n("seeked",e)},onTogglePlayback:()=>n("toggle-playback")}),ie=s(()=>({...h.value?R.attributes.value:{}})),{currentFrac:Z}=R.meta,ee=e=>{T.value=o(e)},te=()=>{T.value=null},ue=e=>{n("seeked",o(e))};let z=null;const q=D(!1),ce=e=>{t.isTabbable||e.preventDefault(),q.value=!1,z=i(e),ee(e)},de=e=>{if(z){const g=i(e);Math.abs(g-z)>$e&&(q.value=!0)}ee(e)},fe=e=>{q.value=!1,z=null,ue(e)},me=()=>{te()},he=e=>{e.stopPropagation(),e.preventDefault()},ve=e=>{n("focus",e)},pe=e=>{R.listeners.blur(),n("blur",e)},ge=s(()=>h.value?{mousedown:ce,mousemove:de,mouseup:fe,mouseleave:me,click:he,blur:pe,focus:ve,keydown:R.listeners.keydown}:{}),be=s(()=>({"--usable-height":`${Math.floor(t.usableFrac*100)}%`,"--unusable-height":`${Math.floor((1-t.usableFrac)*100)}%`})),ke=s(()=>({"--progress-time-left":`${V.value}px`})),ye=s(()=>({"--seek-time-left":`${N.value}px`}));return(e,g)=>(f(),d("div",_e(ie.value,{ref_key:"el",ref:m,class:"waveform bg-background-var group/waveform relative overflow-hidden text-default focus-visible:outline-none",style:be.value,tabIndex:e.isTabbable&&h.value?0:-1,"aria-disabled":!h.value,"aria-label":e.$t("waveform.label")},xe(ge.value,!0)),[h.value?(f(),d("svg",{key:0,class:"shadow-ring-1 absolute inset-0 z-20 hidden h-full w-full group-focus/waveform:block",xmlns:"http://www.w3.org/2000/svg",viewBox:I.value,preserveAspectRatio:"none"},[k(r).width&&k(r).height?(f(),d("rect",{key:0,class:"stroke-focus",x:"0.75",y:"0.75",width:k(r).width-1.5,height:k(r).height-1.5,rx:"2",fill:"none","stroke-width":"1.5"},null,8,Ve)):M("",!0),k(r).width&&k(r).height?(f(),d("rect",{key:1,class:"stroke-white dark:stroke-black",x:"2",y:"2",width:k(r).width-4,height:k(r).height-4,fill:"none","stroke-width":"1",rx:"0.75"},null,8,Ee)):M("",!0)],8,We)):M("",!0),(f(),d("svg",{class:"absolute inset-0 h-full w-full",xmlns:"http://www.w3.org/2000/svg",viewBox:I.value,preserveAspectRatio:"none"},[p.value?(f(),d("rect",{key:0,class:"progress-bar",x:"0",y:"0",width:V.value,height:"100%"},null,8,Le)):M("",!0)],8,qe)),(f(),d("svg",{class:L(["bars absolute bottom-0 w-full",{"with-space":b.value||_.value}]),xmlns:"http://www.w3.org/2000/svg",viewBox:I.value,preserveAspectRatio:"none"},[(f(!0),d(K,null,se(B.value,(F,A)=>(f(),d("rect",{key:A,class:L(["origin-bottom transform transition-transform duration-500",[p.value?"scale-y-100":"scale-y-0",A<=O.value?"fill-wave-active":"fill-wave-inactive"]]),x:W(A),y:J(A),width:j,height:F},null,10,Ne))),128))],10,Ce)),h.value&&x.value?(f(),d("div",{key:1,class:"absolute top-0 z-20 hidden h-full flex-col items-center justify-between bg-black group-focus/waveform:flex group-focus:flex dark:bg-white",style:G({width:`${j}px`,left:`${V.value}px`})},[(f(),d(K,null,se({top:["-translate-y-1/2"],bottom:["translate-y-1/2"]},(F,A)=>re("div",{key:A,class:L(["h-2 w-2 transform rounded-full bg-black dark:bg-white",F])}," Â  ",2)),64))],4)):M("",!0),p.value?(f(),d(K,{key:2},[_.value?(f(),d(K,{key:0},[re("div",{ref_key:"progressTimestampEl",ref:c,class:L(["progress timestamp z-10 transform",[...H.value?["bg-background-var"]:["bg-complementary","-translate-x-full"]]]),style:G(ke.value)},$(k(Q)(C.value,E.value)),7),T.value?(f(),d("div",{key:0,ref_key:"seekTimestampEl",ref:X,class:L(["seek timestamp transform",{"-translate-x-full":!oe.value}]),style:G(ye.value)},$(k(Q)(Y.value,E.value)),7)):M("",!0)],64)):M("",!0),b.value?(f(),d("div",Re,$(k(Q)(e.duration,E.value)),1)):M("",!0)],64)):(f(),d("div",ze,$(e.message),1))],16,De))}}),Je=Me(ne,[["__scopeId","data-v-bc31fa96"]]);ne.__docgenInfo={exportName:"default",displayName:"VWaveform",description:"",tags:{},props:[{name:"peaks",description:`An array of heights of the bars. The waveform will be generated with
bars of random length if the prop is not provided.`,required:!1,type:{name:"Array",elements:[{name:"number"}]}},{name:"message",description:`The message to display instead of the waveform. This is useful when
displaying a loading or error state.`,required:!1,type:{name:"string"}},{name:"currentTime",description:"The current play time of the audio track.",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"duration",description:"The total play time of the audio track.",required:!1,type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"usableFrac",description:`The fraction of the waveform height to use for the bars and timestamp.
The remaining space can be used to place other elements.`,required:!1,type:{name:"number"},defaultValue:{func:!1,value:"1"}},{name:"features",description:"Selectively enable features in the waveform. Available features are\n`'timestamps'`, `'duration'`, `'seek'`.",required:!1,type:{name:"TSTypeOperator"},defaultValue:{func:!1,value:'() => ["timestamps", "seek"] as AudioFeature[]'}},{name:"featureNotices",description:"An object of notices to display when a feature is disabled.\n`'timestamps'`, `'duration'`, `'seek'`.",required:!1,type:{name:"Partial",elements:[{name:"Record",elements:[{name:"AudioFeature"},{name:"string"}]}]},defaultValue:{func:!1,value:"() => ({})"}},{name:"audioId",description:"Audio id to make the randomly-created peaks deterministic.",required:!0,type:{name:"string"}},{name:"isTabbable",description:"Whether the waveform can be focused by using the `Tab` key",required:!1,type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"isParentSeeking",description:`Whether the waveform should render as seeking when it is controlled by
the parent audio track`,required:!1,type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"seeked",type:{names:["number"]},description:`Emitted when the waveform receives mouse events for seeking,
either single clicks on a specific part of the waveform,
or a click and drag.

Also emitted when the waveform receives arrow key or home/end
keyboard events that also correspond to seeking.`},{name:"toggle-playback"},{name:"focus",type:{names:["FocusEvent"]}},{name:"blur",type:{names:["FocusEvent"]}}],sourceFiles:["/home/runner/work/openverse/openverse/frontend/src/components/VAudioTrack/VWaveform.vue"]};export{Je as V,Q as t,Pe as u};
