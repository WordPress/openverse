(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{"./src/pages/search.vue":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var asyncToGenerator=__webpack_require__("../node_modules/.pnpm/@babel+runtime@7.23.2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),objects=(__webpack_require__("../node_modules/.pnpm/regenerator-runtime@0.13.11/node_modules/regenerator-runtime/runtime.js"),__webpack_require__("../node_modules/.pnpm/@wordpress+is-shallow-equal@4.8.0/node_modules/@wordpress/is-shallow-equal/build-module/objects.js")),vue=__webpack_require__("../node_modules/.pnpm/vue@2.7.16/node_modules/vue/dist/vue.js"),shared=__webpack_require__("../node_modules/.pnpm/@vueuse+shared@10.2.1_vue@2.7.16/node_modules/@vueuse/shared/index.cjs"),pinia=__webpack_require__("../node_modules/.pnpm/pinia@2.1.7_typescript@5.4.5_vue@2.7.16/node_modules/pinia/dist/pinia.mjs"),dist_runtime=__webpack_require__("../node_modules/.pnpm/@nuxtjs+composition-api@0.34.0_nuxt@2.17.3_@vue+compiler-sfc@3.3.4_acorn@8.11.3_babel-core@7._cf4v2tncnlhy2kiyx2jjtoxaqm/node_modules/@nuxtjs/composition-api/dist/runtime/index.mjs"),search=__webpack_require__("./src/middleware/search.ts"),feature_flag=__webpack_require__("./src/stores/feature-flag.ts"),stores_media=__webpack_require__("./src/stores/media/index.ts"),stores_search=__webpack_require__("./src/stores/search.ts"),constants_media=__webpack_require__("./src/constants/media.ts"),constants_window=__webpack_require__("./src/constants/window.ts"),search_query_transform=__webpack_require__("./src/utils/search-query-transform.ts"),errors=__webpack_require__("./src/utils/errors.ts"),VErrorSection=__webpack_require__("./src/components/VErrorSection/VErrorSection.vue"),searchvue_type_script_lang_ts=Object(dist_runtime.b)({name:"BrowsePage",components:{VErrorSection:VErrorSection.a},layout:"search-layout",middleware:search.searchMiddleware,fetchOnServer:!1,setup:function setup(){var featureFlagStore=Object(feature_flag.a)(),mediaStore=Object(stores_media.a)(),searchStore=Object(stores_search.b)(),route=Object(dist_runtime.l)(),router=Object(dist_runtime.m)(),_storeToRefs=Object(pinia.e)(searchStore),searchTerm=_storeToRefs.searchTerm,searchType=_storeToRefs.searchType,query=_storeToRefs.apiSearchQueryParams,supported=_storeToRefs.searchTypeIsSupported,_storeToRefs2=Object(pinia.e)(mediaStore),resultCount=_storeToRefs2.resultCount,fetchState=_storeToRefs2.fetchState,needsFetching=Object(vue.computed)((function(){return Boolean(supported.value&&!resultCount.value&&""!==searchTerm.value)})),pageTitle=Object(vue.ref)("".concat(searchTerm.value," | Openverse"));Object(vue.watch)(searchTerm,(function(){pageTitle.value="".concat(searchTerm.value," | Openverse")})),Object(dist_runtime.k)((function(){return{title:pageTitle.value,meta:[{hid:"robots",name:"robots",content:"all"}]}}));var nuxtError=Object(dist_runtime.i)().error,searchResults=Object(vue.ref)(Object(stores_search.a)(searchType.value)?{type:searchType.value,items:searchType.value===constants_media.a?mediaStore.allMedia:mediaStore.resultItems[searchType.value]}:null),fetchMedia=function(){var _ref=Object(asyncToGenerator.a)(regeneratorRuntime.mark((function _callee(){var payload,media,_args=arguments;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(payload=_args.length>0&&void 0!==_args[0]?_args[0]:{},Object(stores_search.a)(searchType.value)){_context.next=3;break}return _context.abrupt("return");case 3:if(!(fetchState.value.hasStarted&&null!==fetchingError.value&&!Object(errors.b)(fetchingError.value))){_context.next=6;break}return _context.abrupt("return");case 6:return payload.shouldPersistMedia||(searchResults.value={type:searchType.value,items:[]}),_context.next=9,mediaStore.fetchMedia(payload);case 9:if(media=_context.sent,searchResults.value={type:searchType.value,items:media},null!==fetchingError.value&&!Object(errors.a)(fetchingError.value)){_context.next=13;break}return _context.abrupt("return",null);case 13:return _context.abrupt("return",nuxtError(fetchingError.value));case 14:case"end":return _context.stop()}}),_callee)})));return function fetchMedia(){return _ref.apply(this,arguments)}}(),fetchingError=Object(vue.computed)((function(){return fetchState.value.fetchingError})),isFetching=Object(vue.computed)((function(){return fetchState.value.isFetching}));Object(vue.watch)(route,function(){var _ref2=Object(asyncToGenerator.a)(regeneratorRuntime.mark((function _callee2(newRoute,oldRoute){var _a;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(newRoute.path===oldRoute.path&&Object(objects.a)(newRoute.query,oldRoute.query)){_context2.next=4;break}return null===(_a=document.getElementById("main-page"))||void 0===_a||_a.scroll(0,0),_context2.next=4,fetchMedia();case 4:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref2.apply(this,arguments)}}()),Object(shared.watchDebounced)(query,(function(newQuery,oldQuery){Object(search_query_transform.a)(newQuery,oldQuery)||router.push(searchStore.getSearchPath())}),{debounce:800,maxWait:5e3});var shouldFetchSensitiveResults=Object(vue.computed)((function(){return featureFlagStore.isOn("fetch_sensitive")}));Object(vue.watch)(shouldFetchSensitiveResults,Object(asyncToGenerator.a)(regeneratorRuntime.mark((function _callee3(){return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,fetchMedia();case 2:case"end":return _context3.stop()}}),_callee3)})))),Object(dist_runtime.j)(Object(asyncToGenerator.a)(regeneratorRuntime.mark((function _callee4(){return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!needsFetching.value){_context4.next=3;break}return _context4.next=3,fetchMedia();case 3:case"end":return _context4.stop()}}),_callee4)}))));var handleLoadMore=function(){var _ref5=Object(asyncToGenerator.a)(regeneratorRuntime.mark((function _callee5(){return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,fetchMedia({shouldPersistMedia:!0});case 2:case"end":return _context5.stop()}}),_callee5)})));return function handleLoadMore(){return _ref5.apply(this,arguments)}}();return{searchTerm:searchTerm,searchType:searchType,supported:supported,query:query,resultCount:resultCount,searchResults:searchResults,isFetching:isFetching,fetchingError:fetchingError,handleLoadMore:handleLoadMore,skipToContentTargetId:constants_window.b}},head:{}}),pages_searchvue_type_script_lang_ts=searchvue_type_script_lang_ts,componentNormalizer=__webpack_require__("../node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.3.4_babel-core@7.0.0-bridge.0_@babel+core@7.24.4__css-_dib6obwdv3d62wiszs4gascedq/node_modules/vue-loader/lib/runtime/componentNormalizer.js");const __vuedocgen_export_0=Object(componentNormalizer.a)(pages_searchvue_type_script_lang_ts,(function render(){var _vm=this,_c=_vm._self._c;_vm._self._setupProxy;return _c("div",{staticClass:"browse-page flex w-full flex-col px-6 lg:px-10",attrs:{id:_vm.skipToContentTargetId,tabindex:"-1"}},[_vm.fetchingError?_c("VErrorSection",{staticClass:"w-full py-10",attrs:{"fetching-error":_vm.fetchingError}}):_c("section",[_c("NuxtChild",{key:_vm.$route.path,attrs:{results:_vm.searchResults,"is-fetching":_vm.isFetching,"search-term":_vm.searchTerm,supported:_vm.supported,"handle-load-more":_vm.handleLoadMore,"data-testid":"search-results"}})],1)],1)}),[],!1,null,null,null).exports;__webpack_exports__.default=__vuedocgen_export_0;__vuedocgen_export_0.__docgenInfo={displayName:"BrowsePage",exportName:"default",description:"",tags:{}}}}]);