import{T as M}from"./BPwGQkdi.js";import{P as A,L as q,a as D,R as $,u as Q,n as V}from"./BnDRGrsR.js";import{g as w,_ as z,w as P,t as W,d as G,s as J,c as U}from"./CzZ80sy2.js";import{d as K,_ as X,at as Y,h as _,D as T,a0 as H,w as I,av as Z,n as ee,L as te,C as y,ah as ae,H as x,K as O,F as re,R as ne,O as N}from"./-WkxctKM.js";import{u as j,b as E,c as oe}from"./DNZ0QEaN.js";import{s as F}from"./D-XGaJuf.js";import{u as se,a as ie,i as L,b as ue,c as le,h as ce}from"./DTU7yJca.js";import{s as de}from"./BOX21o1p.js";import{u as me}from"./R-F224MX.js";import{A as fe}from"./CRWjC3CT.js";import{_ as pe}from"./BcRBA15P.js";import{u as he}from"./DYbvz0cH.js";import{u as ve}from"./Cb-DsD-y.js";import{w as ge}from"./C36Bf8YV.js";import"./CFMQYC2y.js";import"./D_T5hC5T.js";import"./CGhfLDww.js";import"./CVtkxrq9.js";import"./hXBgEdtc.js";import"../sb-preview/runtime.js";import"./Xs_VBmP5.js";import"./HGGXJyB7.js";import"./D0ww02ZN.js";import"./8bxaQBfd.js";import"./Dt-H8hG_.js";import"./Bz7P8nyL.js";import"./RxpDUvxm.js";import"./BSEdKPgk.js";import"./BLIMiQvM.js";import"./HSkZLNjo.js";import"./BXAcwQ7Y.js";import"./CTON8dBl.js";import"./Cpj98o6Y.js";import"./Ci7G4jyV.js";const ye=K({props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(t){const n=t.renderKey,a=t.route,c={};for(const r in t.route)Object.defineProperty(c,r,{get:()=>n===t.renderKey?t.route[r]:a[r],enumerable:!0});return X(A,Y(c)),()=>_(t.vnode,{ref:t.vnodeRef})}}),_e=K({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(t,{attrs:n,slots:a,expose:c}){const r=j(),o=T(),l=H(A,null);let m;c({pageRef:o});const i=H(q,null);let s;const g=r.deferHydration();if(r.isHydrating){const e=r.hooks.hookOnce("app:error",g);D().beforeEach(e)}return t.pageKey&&I(()=>t.pageKey,(e,h)=>{e!==h&&r.callHook("page:loading:start")}),()=>_($,{name:t.name,route:t.route,...n},{default:e=>{const h=Re(l,e.route,e.Component),f=l&&l.matched.length===e.route.matched.length;if(!e.Component){if(s&&!f)return s;g();return}if(s&&i&&!i.isCurrent(e.route))return s;if(h&&l&&(!i||i!=null&&i.isCurrent(l)))return f?s:null;const p=w(e,t.pageKey);!r.isHydrating&&!Se(l,e.route,e.Component)&&m===p&&r.callHook("page:loading:end"),m=p;const d=!!(t.transition??e.route.meta.pageTransition??E),b=d&&ke([t.transition,e.route.meta.pageTransition,E,{onAfterLeave:()=>{r.callHook("page:transition:finish",e.Component)}}].filter(Boolean)),k=t.keepalive??e.route.meta.keepalive??oe;return s=z(M,d&&b,P(k,_(Z,{suspensible:!0,onPending:()=>r.callHook("page:start",e.Component),onResolve:()=>{ee(()=>r.callHook("page:finish",e.Component).then(()=>r.callHook("page:loading:end")).finally(g))}},{default:()=>{const R=_(ye,{key:p||void 0,vnode:a.default?_(te,void 0,a.default(e)):e.Component,route:e.route,renderKey:p||void 0,trackRootNodes:d,vnodeRef:o});return k&&(R.type.name=e.Component.type.name||e.Component.type.__name||"RouteProvider"),R}}))).default(),s}})}});function ke(t){const n=t.map(a=>({...a,onAfterLeave:a.onAfterLeave?W(a.onAfterLeave):void 0}));return G(...n)}function Re(t,n,a){if(!t)return!1;const c=n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)});return!c||c===-1?!1:n.matched.slice(0,c).some((r,o)=>{var l,m,i;return((l=r.components)==null?void 0:l.default)!==((i=(m=t.matched[o])==null?void 0:m.components)==null?void 0:i.default)})||a&&w({route:n,Component:a})!==w({route:t,Component:a})}function Se(t,n,a){return t?n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)})<n.matched.length-1:!1}const be=["id"],xe={key:1},ot=K({name:"SearchPage",__name:"search",async setup(t){let n,a;const c=j(),r=me(),o=se(),l=ie(),m=Q(),{searchTerm:i,searchType:s,apiSearchQueryParams:g}=F(l),{fetchState:e}=F(o),h=T(`${i.value} | Openverse`);I(i,()=>{h.value=`${i.value} | Openverse`}),ve(()=>({title:h.value}));const f=T(L(s.value)?{type:s.value,items:s.value===fe?o.allMedia:o.resultItems[s.value]}:null),p=async(u={})=>{if(!L(s.value)||e.value.hasStarted&&d.value!==null&&!le(d.value))return;u.shouldPersistMedia||(f.value={type:s.value,items:[]});const S=await o.fetchMedia(u);return f.value={type:s.value,items:S},d.value===null||ce(d.value)?S:d.value},d=y(()=>e.value.fetchingError),b=y(()=>e.value.isFetching);ge(g,(u,v)=>{ue(u,v)||V(l.getSearchPath())},{debounce:800,maxWait:5e3});const k=y(()=>m.query),R=y(()=>m.path),B=y(()=>r.isOn("fetch_sensitive")),C=async()=>{await p({shouldPersistMedia:!0})};return[n,a]=ae(async()=>he("search",async()=>{var v;if(c.isHydrating)return f.value;(v=document.getElementById("main-page"))==null||v.scroll(0,0);const u=await p();return!u||u&&"requestKind"in u?J(u??U("No results found")):u},{server:!1,lazy:!0,watch:[B,k,R]})),await n,a(),(u,v)=>{const S=_e;return x(),O("div",{id:N(de),tabindex:"-1",class:"browse-page flex w-full flex-col px-6 lg:px-10"},[d.value?(x(),re(pe,{key:0,"fetching-error":d.value,class:"w-full py-10"},null,8,["fetching-error"])):(x(),O("div",xe,[ne(S,{"page-key":(u._.provides[A]||u.$route).path,results:f.value,"is-fetching":b.value,"search-term":N(i),"handle-load-more":C,"data-testid":"search-results"},null,8,["page-key","results","is-fetching","search-term"])]))],8,be)}}});export{ot as default};
